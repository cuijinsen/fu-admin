var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,n=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&r(e,a,t[a]);if(o)for(var a of o(t))s.call(t,a)&&r(e,a,t[a]);return e},i=(e,o)=>t(e,a(o)),d=(e,t,a)=>new Promise(((o,l)=>{var s=e=>{try{n(a.next(e))}catch(t){l(t)}},r=e=>{try{n(a.throw(e))}catch(t){l(t)}},n=e=>e.done?o(e.value):Promise.resolve(e.value).then(s,r);n((a=a.apply(e,t)).next())}));import{b as p,B as c}from"./index-b361c612.js";import{k as u,B as m}from"./useForm-39f6e704.js";import{a as f,e as h,h as y,s as v,bs as b,o as I,i as x,y as g,m as w,aG as P,E as j}from"./index-d32d699d.js";import{_ as O}from"./index-5d4f29a6.js";import{s as k}from"./index-2e5c6a76.js";import{s as C,a as S,e as _}from"./sysRoleApi-b6b41faf.js";import{s as A}from"./sysDeptApi-2c1e26d4.js";const R=[{title:"角色名称",dataIndex:"roleName",width:150,align:"left"},{title:"角色编码",dataIndex:"roleCode",width:150,align:"left"},{title:"数据范围",dataIndex:"dataScope",width:150},{title:"排序",dataIndex:"sort",width:90},{title:"状态",dataIndex:"sysStatus",width:80},{title:"备注",dataIndex:"remarks"},{title:"创建时间",dataIndex:"createTime",width:160},{title:"更新时间",dataIndex:"updateTime",width:160}],q=[{field:"roleName",label:"角色名称",component:"Input",componentProps:{placeholder:"请输入角色名称"}},{field:"roleCode",label:"角色编码",component:"Input",componentProps:{placeholder:"请输入角色编码"}}],N=[{field:"roleName",label:"角色名称",component:"Input",required:!0,componentProps:{placeholder:"请输入角色名称",maxlength:100}},{field:"roleCode",label:"角色编码",component:"Input",required:!0,componentProps:{placeholder:"请输入角色编码",maxlength:100}},{field:"dataScope",label:"数据范围",component:"ApiSelect",required:!0,componentProps:{placeholder:"请选择数据范围",api:k,params:{dictCode:"sys_data_scope"}}},{field:"deptIds",label:"数据权限",slot:"deptIds",component:"Input",ifShow:({values:e})=>"2"===e.dataScope},{field:"sort",label:"排序",component:"InputNumber",required:!0,defaultValue:"1",componentProps:{placeholder:"请输入排序",min:1}},{field:"sysStatus",label:"状态",component:"ApiRadioGroup",required:!0,componentProps:{api:k,params:{dictCode:"sys_status"}},defaultValue:"0"},{label:"备注",field:"remarks",component:"InputTextArea",componentProps:{placeholder:"请输入备注",maxlength:500}}],D=f({__name:"FormModal",emits:["success","register"],setup(e,{emit:t}){const a=h((()=>y(o)?"编辑角色":"新增角色")),o=v(!1),l=v(),s=v([]),r=v([]),f=v([]),k=v(new Set),R=v(!1);b((()=>{!function(){d(this,null,(function*(){s.value=yield A()}))}()}));const{createMessage:q}=j(),[D,{setFieldsValue:F,resetFields:M,validate:B}]=u({labelWidth:100,schemas:N,showActionButtonGroup:!1,actionColOptions:{span:23},baseColProps:{span:24}}),[G,{setModalProps:K,closeModal:L}]=p((e=>d(this,null,(function*(){if(yield M(),K({confirmLoading:!1}),o.value=!!(null==e?void 0:e.isUpdate),y(o)){l.value=e.record.id;const t=yield C({roleId:l.value});k.value=new Set(t.filter((e=>"0"!==e.parentId)).map((e=>e.parentId))),r.value=t.filter((e=>!k.value.has(e.id))).map((e=>e.id)),yield F(n({},e.record))}}))));function T(){return d(this,null,(function*(){try{const e=yield B();K({confirmLoading:!0});const a=y(R)?[...r.value,...f.value]:[...r.value,...Array.from(k.value)];y(o)?yield _(i(n({},e),{id:l.value,deptIds:a})):yield S(i(n({},e),{deptIds:a})),y(o)?q.success("编辑成功！"):q.success("新增成功！"),L(),t("success",{isUpdate:y(o),values:i(n({},e),{id:l.value,deptIds:a})})}finally{K({confirmLoading:!1})}}))}function V(e,t){y(R)||(R.value=!0),r.value=e,f.value=t.halfCheckedKeys}return(e,t)=>(I(),x(y(c),P(e.$attrs,{destroyOnClose:"",onRegister:y(G),title:a.value,onOk:T}),{default:g((()=>[w(y(m),{onRegister:y(D)},{deptIds:g((()=>[w(y(O),{checkedKeys:r.value,treeData:s.value,checkable:"",onCheck:V,title:"选择部门",fieldNames:{key:"id",title:"name"}},null,8,["checkedKeys","treeData"])])),_:1},8,["onRegister"])])),_:1},16,["onRegister","title"]))}});export{D as _,R as c,q as s};
