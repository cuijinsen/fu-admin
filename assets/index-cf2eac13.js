var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,o=(t,l,a)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a,r=(e,t,l)=>new Promise(((a,i)=>{var d=e=>{try{r(l.next(e))}catch(t){i(t)}},o=e=>{try{r(l.throw(e))}catch(t){i(t)}},r=e=>e.done?a(e.value):Promise.resolve(e.value).then(d,o);r((l=l.apply(e,t)).next())}));import{a as n,s,bs as u,v as m,r as c,aF as f,o as p,f as v,m as h,y as b,F as y,aI as g,i as V,aG as C,f3 as _,h as w,z as k,f4 as x}from"./index-d32d699d.js";import{s as I}from"./sysAreaApi-e41d1f2f.js";import{d as U,h as R,s as j,i as O,a as W,j as P}from"./sysDeptApi-2c1e26d4.js";import{T as N}from"./index-fe305bf5.js";import"./iconUtil-b885d1ac.js";import"./eagerComputed-b16e681c.js";const z=[{type:"checkbox"},{type:"seq",minWidth:60,title:"序号"},{title:"id",field:"id",minWidth:80,visible:!1},{title:"parentId",field:"parentId",minWidth:80,visible:!1},{title:"店铺id",field:"deptId",minWidth:80,visible:!1},{title:"品牌名",field:"brand",minWidth:80},{title:"店铺名称",field:"deptName",minWidth:80,treeNode:!0},{title:"省份",field:"province",minWidth:80},{title:"城市",field:"city",minWidth:80},{title:"地区",field:"district",minWidth:80,editRender:{},slots:{edit:"district_edit"}},{title:"创建时间",field:"createTime",minWidth:120},{title:"修改时间",field:"updateTime",minWidth:120},{title:"操作",width:300,slots:{default:"operate"}}],D=[{field:"id",title:"品牌名",itemRender:{},editRender:{},slots:{default:"name_item"}},{field:"province",title:"省份",itemRender:{},editRender:{},slots:{default:"province_item"}},{field:"city",title:"城市",itemRender:{},editRender:{},slots:{default:"city_item"}},{field:"district",title:"区域",itemRender:{},editRender:{},slots:{default:"district_item"}},{itemRender:{},slots:{default:"submit_item"}},{itemRender:{},slots:{default:"reset_item"}}],S=n((E=((e,t)=>{for(var l in t||(t={}))i.call(t,l)&&o(e,l,t[l]);if(a)for(var l of a(t))d.call(t,l)&&o(e,l,t[l]);return e})({},{name:"UpdateOpen"}),t(E,l({setup(e){const t=s(),l=s([]),a=s([]),i=s([]),d=s([]),o=s([]);u((()=>r(this,null,(function*(){l.value=yield I({parentCode:"0"}),d.value=yield U({}),yield function(){return r(this,null,(function*(){"1406955981362733058"==c().getUserInfo.deptId&&(L.value=yield j().then((e=>e.map((e=>({id:e.id,label:e.name,title:e.name,value:e.id,key:e.id,pId:e.parentId}))))))}))}()}))));const n=m({showEdit:!1,submitLoading:!1,formData:{deptId:[],province:"",city:"",district:""},rules:{deptId:[{validator({}){if(0===o.value.length)return new Error("请选择店家")}}],district:[{required:!0,message:"请选择区域"}]}}),S=m({border:!0,keepSource:!0,height:800,columnConfig:{resizable:!0},rowConfig:{keyField:"id"},treeConfig:{transform:!0,rowField:"id",parentField:"parentId"},checkboxConfig:{reserve:!0},showOverflow:!0,showHeaderOverflow:!0,formConfig:{titleWidth:150,titleAlign:"right",items:D},align:"center",toolbarConfig:{tools:[{name:"新增",code:"MyInsert"},{name:"批量删除",code:"MyDelete"}],refresh:!0,zoom:!0,custom:!0},pagerConfig:{pageSize:10,pageSizes:[5,10,20,50,100,200,500,1e3]},sortConfig:{trigger:"cell",remote:!0,defaultSort:{field:"createTime",order:"desc"}},filterConfig:{remote:!0},proxyConfig:{seq:!0,sort:!0,filter:!0,form:!0,props:{result:"records",total:"total"},ajax:{query:({page:e,sorts:t,filters:l,form:a})=>{const i=Object.assign({current:e.currentPage,size:e.pageSize},a),d=null==t?void 0:t[0];return d&&(i.field=d.field,i.order=d.order),(null==l?void 0:l.length)>0&&l.forEach((({field:e,values:t})=>{i[e]=t.join(",")})),R(i)}}},columns:z,editConfig:{trigger:"click",mode:"row",showStatus:!0}}),E={toolbarToolClick({code:e}){const l=t.value;if(l)switch(e){case"MyInsert":n.formData={deptId:[],province:"",city:"",district:""},n.showEdit=!0;break;case"MyDelete":{const e=l.getCheckboxRecords(),t=e.map((e=>e.id));e.length>0?x.modal.confirm("您确定要删除选中的数据?").then((e=>{"confirm"===e&&(S.loading=!0,O({ids:t}).then((()=>{S.loading=!1,x.modal.message({content:"删除成功",status:"success"}),l.commitProxy("reload")})))})):x.modal.alert("没有选中的数据");break}}}},L=s(),F=e=>r(this,null,(function*(){const t=e.id;return e.dataRef.children||(e.dataRef.children=yield W({nodeId:t,userId:c().getUserInfo.userId}).then((t=>t[0].children?t[0].children.map((e=>({id:e.id,label:e.name,title:e.name,key:e.id,value:e.id,pId:e.parentId}))):(e.dataRef.isLeaf=!0,[]))),e.dataRef.children.length>0?(e.dataRef.isLeaf=!1,L.value=L.value.concat(e.dataRef.children)):(e.dataRef.isLeaf=!0,L.value=[...L.value])),Promise.resolve()})),T=e=>r(this,null,(function*(){const l=yield x.modal.confirm("您确定要删除该数据?"),a=t.value;a&&"confirm"===l&&(yield O({ids:e.id}),yield a.remove(e))}));function q(e){return r(this,null,(function*(){a.value=yield I({parentCode:e.value})}))}const A=()=>r(this,null,(function*(){n.submitLoading=!0;const e=t.value;e&&(n.showEdit=!1,n.formData.deptId=o.value.map((e=>e.value)),P(n.formData).then((()=>{x.modal.message({content:"新增成功",status:"success"}),e.commitProxy("reload"),n.submitLoading=!1}),(e=>{n.submitLoading=!1,x.modal.message({content:"新增失败,错误"+e,status:"error"})})))}));function M(e){return r(this,null,(function*(){i.value=yield I({parentCode:e.value})}))}function G(e){return r(this,null,(function*(){i.value=yield I({parentCode:e.value.substring(0,4)+"00"})}))}return(e,r)=>{const s=f("vxe-option"),u=f("vxe-select"),m=f("vxe-button"),c=f("vxe-grid"),x=f("vxe-form-item"),I=f("vxe-form"),U=f("vxe-modal");return p(),v("div",null,[h(c,C({ref_key:"xGrid",ref:t},S,_(E)),{name_item:b((({data:e})=>[h(u,{modelValue:e.id,"onUpdate:modelValue":t=>e.id=t,clearable:"",placeholder:"请选择品牌名"},{default:b((()=>[(p(!0),v(y,null,g(d.value,((e,t)=>(p(),V(s,{key:t,label:e.deptName,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),province_item:b((({data:e})=>[h(u,{modelValue:e.province,"onUpdate:modelValue":t=>e.province=t,clearable:"",placeholder:"请选择省份",onChange:q},{default:b((()=>[(p(!0),v(y,null,g(l.value,((e,t)=>(p(),V(s,{key:t,label:e.areaName,value:e.areaCode},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),city_item:b((({data:e})=>[h(u,{modelValue:e.city,"onUpdate:modelValue":t=>e.city=t,clearable:"",placeholder:"请选择城市",onChange:M},{default:b((()=>[(p(!0),v(y,null,g(a.value,((e,t)=>(p(),V(s,{key:t,label:e.areaName,value:e.areaCode},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),district_item:b((({data:e})=>[h(u,{modelValue:e.district,"onUpdate:modelValue":t=>e.district=t,clearable:"",placeholder:"请选择区域"},{default:b((()=>[(p(!0),v(y,null,g(i.value,((e,t)=>(p(),V(s,{key:t,label:e.areaName,value:e.areaCode},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),district_edit:b((({row:e})=>[h(u,{modelValue:e.district,"onUpdate:modelValue":t=>e.district=t,clearable:"",placeholder:"请选择区域",onClick:G},{default:b((()=>[(p(!0),v(y,null,g(i.value,((e,t)=>(p(),V(s,{key:t,label:e.areaName,value:e.areaCode},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),operate:b((({row:e})=>[h(m,{content:"删除",status:"danger",onClick:t=>T(e)},null,8,["onClick"])])),submit_item:b((()=>[h(m,{content:"查询",status:"primary",type:"submit"})])),reset_item:b((()=>[h(m,{content:"重置",type:"reset"})])),_:1},16),h(U,{modelValue:n.showEdit,"onUpdate:modelValue":r[1]||(r[1]=e=>n.showEdit=e),loading:n.submitLoading,"destroy-on-close":"",height:"400",resize:"","show-zoom":"",title:" 新增",width:"800"},{default:b((()=>[h(I,{data:n.formData,rules:n.rules,"title-align":"right","title-width":"100",onSubmit:A},{default:b((()=>[h(x,{"item-render":{},span:12,field:"deptId",title:"店家"},{default:b((({})=>[h(w(N),{value:o.value,"onUpdate:value":r[0]||(r[0]=e=>o.value=e),"dropdown-style":{maxHeight:"400px",overflow:"auto"},"load-data":F,"tree-data":L.value,allowClear:"",placeholder:"请选择店家",showSearch:"",style:{width:"300px"},"tree-check-strictly":"","tree-checkable":"","tree-data-simple-mode":"","tree-node-filter-prop":"title"},null,8,["value","tree-data"])])),_:1}),h(x,{"item-render":{},span:12,field:"province",title:"省"},{default:b((({data:e})=>[h(u,{modelValue:e.province,"onUpdate:modelValue":t=>e.province=t,clearable:"",placeholder:"请选择省份",onChange:q},{default:b((()=>[(p(!0),v(y,null,g(l.value,((e,t)=>(p(),V(s,{key:t,label:e.areaName,value:e.areaCode},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),h(x,{"item-render":{},span:12,field:"city",title:"市"},{default:b((({data:e})=>[h(u,{modelValue:e.city,"onUpdate:modelValue":t=>e.city=t,clearable:"",placeholder:"请选择城市",onChange:M},{default:b((()=>[(p(!0),v(y,null,g(a.value,((e,t)=>(p(),V(s,{key:t,label:e.areaName,value:e.areaCode},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),h(x,{"item-render":{},span:12,field:"district",title:"区域"},{default:b((({data:e})=>[h(u,{modelValue:e.district,"onUpdate:modelValue":t=>e.district=t,clearable:"",placeholder:"请选择区域"},{default:b((()=>[(p(!0),v(y,null,g(i.value,((e,t)=>(p(),V(s,{key:t,label:e.areaName,value:e.areaCode},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),h(x,{span:24,align:"center","title-align":"left"},{default:b((()=>[h(m,{type:"submit"},{default:b((()=>[k("提交")])),_:1}),h(m,{type:"reset"},{default:b((()=>[k("重置")])),_:1})])),_:1})])),_:1},8,["data","rules"])])),_:1},8,["modelValue","loading"])])}}}))));var E;export{S as default};
