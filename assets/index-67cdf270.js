var e=(e,t,o)=>new Promise(((i,s)=>{var n=e=>{try{d(o.next(e))}catch(t){s(t)}},r=e=>{try{d(o.throw(e))}catch(t){s(t)}},d=e=>e.done?i(e.value):Promise.resolve(e.value).then(n,r);d((o=o.apply(e,t)).next())}));import{u as t,B as o}from"./useTable-ba3fb261.js";import{T as i}from"./useForm-39f6e704.js";import{a as s,J as n,e as r,r as d,aF as a,bT as c,o as u,f as p,m as l,y as m,h as f,w as j,i as b,z as g,j as x,E as y}from"./index-d32d699d.js";import{I as h}from"./index-a72363e5.js";import{u as I}from"./index-b361c612.js";import{c as _,s as P,_ as C}from"./FormModal.vue_vue_type_script_setup_true_lang-96d470b7.js";import{g as k,k as v,r as w,c as F}from"./productApi-29a579d7.js";import{a as S}from"./download-29600a9b.js";import{_ as O}from"./AddStock.vue_vue_type_script_setup_true_lang-6adc8545.js";import"./index-428eee78.js";import"./eagerComputed-b16e681c.js";import"./css-49036a2d.js";import"./fromPairs-c5e23fef.js";import"./iconUtil-b885d1ac.js";import"./index-22735145.js";import"./index-e84e313c.js";import"./createForOfIteratorHelper-19a6e609.js";import"./index-da1a1de3.js";import"./index-64da741e.js";import"./scrollTo-7d931d9a.js";import"./index-ceb1e509.js";import"./index-e9d5eda1.js";import"./index-2887dac0.js";import"./useSize-e28be3fa.js";import"./useWindowSizeFn-6acabc85.js";import"./useContentViewHeight-295eef1a.js";import"./ArrowLeftOutlined-f42bc447.js";import"./index-9c0d62a6.js";import"./transButton-c20bc4d9.js";import"./index-706c8391.js";import"./index-bf8f159c.js";import"./index-ee500efb.js";import"./index-280a19eb.js";import"./get-8e454bdf.js";import"./index-b4d18824.js";import"./sortable.esm-871e648d.js";import"./RedoOutlined-481f10d7.js";import"./FullscreenOutlined-091fbcf5.js";import"./index-f7867750.js";import"./index-6cd0fcd2.js";import"./index-06c8a48f.js";import"./index-cd646f4b.js";import"./_baseIteratee-b178d67d.js";import"./index-fe305bf5.js";import"./index-476a8598.js";import"./useRefs-b0536d84.js";import"./index-406c2228.js";import"./index-8e2feec8.js";import"./uniqBy-19fec0f2.js";import"./index-2e5c6a76.js";const R=s({__name:"index",setup(s,{expose:R}){const{createMessage:U,createConfirm:T}=y(),[A,{openModal:B}]=I(),[z,{openModal:M}]=I(),[E,{reload:H,getForm:V,getDataSource:W}]=t({title:"商品列表 ",api:k,rowKey:"id",columns:_,formConfig:{baseColProps:{sm:24,lg:6},labelWidth:90,schemas:P,autoSubmitOnEnter:!0,resetButtonOptions:{preIcon:"ant-design:delete-outlined"},submitButtonOptions:{preIcon:"ant-design:search-outlined"}},showIndexColumn:!1,useSearchForm:!0,showTableSetting:!0,bordered:!0,actionColumn:{auth:["system:Product:updateProduct","system:Product:removeProduct"],width:120,title:"操作",dataIndex:"action"},beforeFetch:function(e){return Object.assign(e,{deptId:d().getUserInfo.deptId})}});let q;function D(t){return e(this,null,(function*(){M(!0,{record:t})}))}function J(){const e={deptId:d().getUserInfo.deptId};B(!0,{record:e,isUpdate:!1})}function K(){return e(this,null,(function*(){const e={deptId:d().getUserInfo.deptId};yield v({deptId:e.deptId}),U.success("导入成功！"),yield H()}))}function L(e){e.deptId=""===e.deptId?null:e.deptId,B(!0,{record:e,isUpdate:!0})}function G(t){return e(this,null,(function*(){yield w({ids:t.id}),U.success("删除成功！"),yield H()}))}function N(){return e(this,null,(function*(){T({iconType:"warning",title:"提示",content:"确认导出？",onOk:()=>e(this,null,(function*(){const e=V().getFieldsValue(),t=yield F(e),o=t.data;if(!t.headers["content-disposition"])return void U.error("导出失败！");const i=t.headers["content-disposition"].split(";")[1].split("=")[1],s=decodeURIComponent(escape(i));S(o,s)}))})}))}function Q(t){return e(this,arguments,(function*({isUpdate:e,values:t}){yield H()}))}return n((()=>{q=r((()=>0===W().length))})),R({refresh:function(){H()}}),(e,t)=>{const s=a("a-button"),n=c("auth");return u(),p("div",null,[l(f(o),{onRegister:f(E)},{toolbar:m((()=>[f(q)?j((u(),b(s,{key:0,color:"success",preIcon:"ant-design:euro-circle-outlined",onClick:K},{default:m((()=>[g("导入展示商品 ")])),_:1})),[[n,["system:Product:importProduct"]]]):x("",!0),j((u(),b(s,{preIcon:"ant-design:plus-outlined",type:"primary",onClick:J},{default:m((()=>[g("新增 ")])),_:1})),[[n,["system:Product:addProduct"]]]),j((u(),b(s,{color:"warning",preIcon:"ant-design:download-outlined",onClick:N},{default:m((()=>[g("导出 ")])),_:1})),[[n,["system:Product:exportProduct"]]])])),bodyCell:m((({column:e,record:t})=>["imgAddr"===e.key?(u(),b(f(h),{key:0,size:60,src:t.imgAddr},null,8,["src"])):x("",!0),"action"===e.key?(u(),b(f(i),{key:1,actions:[{auth:["system:Product:updateProduct"],icon:"clarity:note-edit-line",tooltip:"编辑",onClick:L.bind(null,t)},{auth:["system:Product:removeProduct"],icon:"ant-design:delete-outlined",tooltip:"删除",color:"error",popConfirm:{title:"是否确认删除",confirm:G.bind(null,t)}},{auth:["system:Product:addProductStock"],icon:"ant-design:plus-outlined",tooltip:"添加库存",onClick:D.bind(null,t)}]},null,8,["actions"])):x("",!0)])),_:1},8,["onRegister"]),l(C,{onRegister:f(A),onSuccess:Q},null,8,["onRegister"]),l(O,{onRegister:f(z),onSuccess:Q},null,8,["onRegister"])])}}});export{R as default};
