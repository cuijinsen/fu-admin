var e=Object.defineProperty,o=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,n=(o,t,r)=>t in o?e(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,i=(e,o)=>{for(var t in o||(o={}))l.call(o,t)&&n(e,t,o[t]);if(r)for(var t of r(o))a.call(o,t)&&n(e,t,o[t]);return e},d=(e,r)=>o(e,t(r)),s=(e,o,t)=>new Promise(((r,l)=>{var a=e=>{try{i(t.next(e))}catch(o){l(o)}},n=e=>{try{i(t.throw(e))}catch(o){l(o)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,n);i((t=t.apply(e,o)).next())}));import{b as p,B as c}from"./index-b361c612.js";import{k as u,B as m}from"./useForm-39f6e704.js";import{bV as f,a as b,e as h,h as P,s as y,r as v,o as I,i as x,y as g,m as w,aG as j,E as A}from"./index-d32d699d.js";import{v as O,a as C,e as N}from"./productApi-29a579d7.js";import{T as R}from"./index-280a19eb.js";import{a as S,s as k}from"./index-2e5c6a76.js";const B=[{title:"所属店铺",dataIndex:"deptName",width:120},{title:"商品名称",dataIndex:"productName",width:120},{title:"商品描述",dataIndex:"productDesc",width:120},{title:"商品图片",dataIndex:"imgAddr",width:120},{title:"正常价格",dataIndex:"normalPrice",customRender:({record:e})=>e.normalPrice+"元",width:80},{title:"打折价格",dataIndex:"promotionPrice",customRender:({record:e})=>e.promotionPrice+"元",width:80},{title:"商品库存",dataIndex:"stock",width:80},{title:"是否上架",dataIndex:"enableStatus",customRender:({record:e})=>{const o=1==~~e.enableStatus,t=o?"已上架":"未上架";return f(R,{color:o?"green":"red"},(()=>t))},width:80},{title:"审核状态",dataIndex:"priority",width:80,customRender:({record:e})=>{const o=1==~~e.priority,t=o?"已审核":"未审核";return f(R,{color:o?"blue":"red"},(()=>t))}}],_=[{field:"productName",label:"商品名称",component:"Input",componentProps:{placeholder:"请输入商品名称"}},{field:"priority",label:"审核状态",component:"Select",componentProps:{placeholder:"请选择审核状态",options:[{label:"已审核",value:"1",key:"1"},{label:"未审核",value:"2",key:"2"}]}},{field:"enableStatus",label:"上架状态",component:"Select",componentProps:{placeholder:"请选择上架状态",options:[{label:"已上架",value:"1",key:"1"},{label:"已下架",value:"2",key:"2"}]}}],T=[{field:"id",label:"商品Id",component:"Input",show:!1,componentProps:{placeholder:"请输入商品Id"}},{field:"productName",label:"商品名称",component:"Input",componentProps:{placeholder:"请输入商品名称"}},{field:"productDesc",label:"商品描述",component:"InputTextArea",componentProps:{placeholder:"请输入商品描述"}},{field:"imgAddr",label:"商品图片",component:"UploadImg",componentProps:({formModel:e})=>({uploadApi:S,value:e.imgAddr,btnText:"选择图片",btnProps:{preIcon:"ant-design:cloud-upload-outlined"},width:"150"})},{field:"productCategoryId",label:"商品类别",component:"ApiRadioGroup",required:!0,componentProps:{api:k,params:{dictCode:"fubao_product_category"}},defaultValue:"2"},{field:"normalPrice",label:"商品原价",component:"Input",rules:[{required:!0,validator:(e,o)=>isNaN(o)?Promise.reject("请输入数字"):Promise.resolve()}],renderComponentContent:()=>({prefix:()=>"￥"}),componentProps:{placeholder:"请输入商品原价"}},{field:"promotionPrice",label:"商品折扣价",component:"Input",rules:[{required:!0,validator:(e,o)=>isNaN(o)?Promise.reject("请输入数字"):Promise.resolve()}],renderComponentContent:()=>({prefix:()=>"￥"}),componentProps:{placeholder:"请输入商品折扣价"},defaultValue:0},{field:"stock",label:"商品库存",component:"Input",suffix:"件",rules:[{required:!0,validator:(e,o)=>isNaN(o)?Promise.reject("请输入数字"):Promise.resolve()}],componentProps:{placeholder:"请输入商品库存"}},{field:"expireTime",label:"商品有效期",component:"Input",helpMessage:"不填默认为永久有效",suffix:"天",componentProps:{placeholder:"请输入商品有效期"}},{field:"sortOrder",label:"商品排序",component:"InputNumber",componentProps:{placeholder:"请输入商品排序"}},{field:"enableStatus",label:"上架状态",component:"ApiRadioGroup",required:!0,componentProps:{api:k,params:{dictCode:"fubao_product_enableStatus"}},defaultValue:"1"},{field:"isBirth",label:"有效期关联时间",component:"RadioGroup",ifShow:({values:e})=>!!e.expireTime,componentProps:({})=>({options:[{label:"与分娩时间关联",value:"1"},{label:"与领取时间关联",value:"2"},{label:"不关联",value:""}]})},{field:"createByAid",label:"创建人",component:"Input",slot:"createByAid",show:!1,componentProps:{}}],M=b({__name:"FormModal",emits:["success","register"],setup(e,{emit:o}){const t=h((()=>P(r)?"编辑商品":"新增商品")),r=y(!1),l=y(),a=y(),{createMessage:n}=A(),[f,{setFieldsValue:b,resetFields:R,validate:S,updateSchema:k}]=u({labelWidth:100,wrapperCol:{span:12},schemas:T,showActionButtonGroup:!1,actionColOptions:{span:23},baseColProps:{lg:12,md:24}}),[B,{setModalProps:_,closeModal:M}]=p((e=>s(this,null,(function*(){if(yield R(),_({confirmLoading:!1}),r.value=!!(null==e?void 0:e.isUpdate),a.value=null==e?void 0:e.record.deptId,P(r)){l.value=e.record.id;const o=yield O({id:e.record.id});-1===o.expireTime&&(o.expireTime=null,o.isBirth=null),yield b(d(i({},o),{createByAid:v().getUserInfo.userId})),yield k({field:"stock",componentProps:{disabled:!0}})}else yield b({createByAid:v().getUserInfo.userId})}))));function q(){return s(this,null,(function*(){try{const e=yield S();_({confirmLoading:!0}),P(r)?yield N(d(i({},e),{id:l.value})):yield C(d(i({},e),{shopId:a.value})),P(r)?n.success("编辑成功！"):n.success("新增成功！"),M(),o("success",{isUpdate:P(r),values:d(i({},e),{id:l.value})})}finally{_({confirmLoading:!1})}}))}return(e,o)=>(I(),x(P(c),j({title:t.value,destroyOnClose:""},e.$attrs,{width:"900px",onOk:q,onRegister:P(B)}),{default:g((()=>[w(P(m),{onRegister:P(f)},null,8,["onRegister"])])),_:1},16,["title","onRegister"]))}});export{M as _,B as c,_ as s};
