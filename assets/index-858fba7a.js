var e=(e,t,l)=>new Promise(((a,o)=>{var d=e=>{try{n(l.next(e))}catch(t){o(t)}},i=e=>{try{n(l.throw(e))}catch(t){o(t)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(d,i);n((l=l.apply(e,t)).next())}));import{cR as t,a as l,s as a,v as o,bs as d,aF as i,o as n,f as u,m as s,y as r,F as m,aI as p,i as h,l as c,t as f,aG as y,f3 as x,z as V,f4 as g}from"./index-d32d699d.js";import{s as W,g as v}from"./sysAreaApi-e41d1f2f.js";const U=[{type:"checkbox"},{type:"seq",minWidth:60,title:"序号"},{title:"公众号id",field:"pushWxCode",minWidth:80,editRender:{},slots:{edit:"pushWxCode_edit"}},{title:"短信标题",field:"pushWxFirstValue",minWidth:80,editRender:{},slots:{edit:"pushWxFirstValue_edit"}},{title:"短信内容",field:"phoneMsg",minWidth:80,editRender:{},slots:{edit:"phoneMsg_edit"}},{title:"公众号类型",field:"pushWxContent",minWidth:80,editRender:{},slots:{edit:"pushWxContent_edit"}},{title:"公众号备注",field:"pushWxRemark",minWidth:80,editRender:{},slots:{edit:"pushWxRemark_edit"}},{title:"区域",field:"cityName",minWidth:80,editRender:{},slots:{default:"cityName_default",edit:"cityName_edit"}},{title:"短信url",field:"pushWxUrl",minWidth:80,editRender:{},slots:{edit:"pushWxUrl_edit"}},{title:"操作",width:300,slots:{default:"operate"}}],C=[{field:"city",title:"城市",itemRender:{},editRender:{},slots:{default:"city_item"}},{field:"type",title:"短信类型",itemRender:{},editRender:{},slots:{default:"type_item"}},{itemRender:{},slots:{default:"submit_item"}},{itemRender:{},slots:{default:"reset_item"}}];const _=l({__name:"index",setup(l){const _=a(),b=a([]),w=a([]),R=a([{code:"one",name:"第一条"},{code:"two",name:"第二条"},{code:"three",name:"第三条"}]),k=o({showEdit:!1,submitLoading:!1,formData:{pushWxCode:"",pushWxFirstValue:"",phoneMsg:"",pushWxContent:"",pushWxRemark:"",cityName:"",pushWxUrl:"",type:""}}),N=o({list42:[]});d((()=>e(this,null,(function*(){b.value=yield W({parentCode:"370000"})}))));const M=o({border:!0,keepSource:!0,height:850,columnConfig:{isCurrent:!0,resizable:!0},rowConfig:{keyField:"id"},checkboxConfig:{reserve:!0},showOverflow:!0,showHeaderOverflow:!0,formConfig:{titleWidth:150,titleAlign:"right",items:C},pagerConfig:{pageSize:20,pageSizes:[5,10,20,50,100,200,500,1e3]},align:"center",toolbarConfig:{tools:[{name:"保存修改",code:"MyUpdate"},{name:"批量修改",code:"MyUpdateBatch"}],refresh:!0,zoom:!0,custom:!0},proxyConfig:{seq:!0,form:!0,props:{result:"list",total:"total"},ajax:{query:({page:e,form:l})=>{const a=Object.assign({current:e.currentPage,size:e.pageSize},l);var o;return o=a,t.get({url:"/system/sysArea/selectSysAreaWithSmsContent",params:o})}}},columns:U,editConfig:{trigger:"click",mode:"row",showStatus:!0}}),F=e=>{const t=_.value;return!!t&&t.isEditByRow(e)},z={toolbarToolClick(l){return e(this,arguments,(function*({code:e}){const l=_.value;if(l)switch(e){case"MyUpdate":{const e=l.getTableData(),a=l.getProxyInfo();e.tableData.length>0?g.modal.confirm("您确定要保存修改的数据?").then((l=>{var o;"confirm"===l&&(M.loading=!0,(o={smsContent:e.tableData,city:null==a?void 0:a.form.city,type:null==a?void 0:a.form.type},t.post({url:"/system/sysArea/updateSmsContent",params:o})).then((()=>{M.loading=!1})))})):g.modal.alert("没有修改的数据");break}case"MyUpdateBatch":{const e=l.getTableData(),t=l.getProxyInfo();if(e.tableData.length>0){k.formData=e.tableData[0];const l=yield v({cityCode:null==t?void 0:t.form.city});k.formData.cityName=l.map((e=>e.areaCode)),N.list42=w.value.map((e=>({label:e.areaName,value:e.areaCode}))),k.showEdit=!0}else g.modal.alert("没有修改的数据");break}}}))}},D=()=>e(this,null,(function*(){k.submitLoading=!0;const e=_.value;var l;e&&(k.showEdit=!1,(l=k.formData,t.post({url:"/system/sysArea/updateSmsContentBatch",params:l})).then((()=>{g.modal.message({content:"修改成功",status:"success"}),e.commitProxy("reload"),k.submitLoading=!1}),(e=>{k.submitLoading=!1,g.modal.message({content:"新增失败,错误"+e,status:"error"})})))})),S=()=>{const e=_.value;e&&e.clearEdit()},E=e=>{const t=w.value.find((t=>t.areaCode===e));return t?t.areaName:""};function P(t){return e(this,null,(function*(){w.value=yield W({parentCode:t.value});const e=_.value;e&&(yield e.commitProxy("reload"))}))}function A(){return e(this,null,(function*(){const e=_.value;e&&(yield e.commitProxy("reload"))}))}return(e,t)=>{const l=i("vxe-option"),a=i("vxe-select"),o=i("vxe-input"),d=i("vxe-textarea"),g=i("vxe-button"),W=i("vxe-grid"),v=i("vxe-form-item"),U=i("vxe-form"),C=i("vxe-modal");return n(),u("div",null,[s(W,y({ref_key:"xGrid",ref:_},M,x(z)),{city_item:r((({data:e})=>[s(a,{modelValue:e.city,"onUpdate:modelValue":t=>e.city=t,clearable:"",placeholder:"请选择城市",onChange:P},{default:r((()=>[(n(!0),u(m,null,p(b.value,((e,t)=>(n(),h(l,{key:t,label:e.areaName,value:e.areaCode},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),type_item:r((({data:e})=>[s(a,{modelValue:e.type,"onUpdate:modelValue":t=>e.type=t,clearable:"",placeholder:"请选择类型",onChange:A},{default:r((()=>[(n(!0),u(m,null,p(R.value,((e,t)=>(n(),h(l,{key:t,label:e.name,value:e.code},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),cityName_default:r((({row:e})=>[c("span",null,f(E(e.cityName)),1)])),pushWxCode_edit:r((({row:e})=>[s(o,{modelValue:e.pushWxCode,"onUpdate:modelValue":t=>e.pushWxCode=t,type:"text"},null,8,["modelValue","onUpdate:modelValue"])])),pushWxFirstValue_edit:r((({row:e})=>[s(d,{modelValue:e.pushWxFirstValue,"onUpdate:modelValue":t=>e.pushWxFirstValue=t,type:"text"},null,8,["modelValue","onUpdate:modelValue"])])),phoneMsg_edit:r((({row:e})=>[s(d,{modelValue:e.phoneMsg,"onUpdate:modelValue":t=>e.phoneMsg=t,type:"text"},null,8,["modelValue","onUpdate:modelValue"])])),pushWxContent_edit:r((({row:e})=>[s(d,{modelValue:e.pushWxContent,"onUpdate:modelValue":t=>e.pushWxContent=t,type:"text"},null,8,["modelValue","onUpdate:modelValue"])])),pushWxRemark_edit:r((({row:e})=>[s(d,{modelValue:e.pushWxRemark,"onUpdate:modelValue":t=>e.pushWxRemark=t,type:"text"},null,8,["modelValue","onUpdate:modelValue"])])),cityName_edit:r((({row:e})=>[s(a,{modelValue:e.cityName,"onUpdate:modelValue":t=>e.cityName=t,clearable:"",placeholder:"请选择区域"},{default:r((()=>[(n(!0),u(m,null,p(w.value,((e,t)=>(n(),h(l,{key:t,label:e.areaName,value:e.areaCode},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),pushWxUrl_edit:r((({row:e})=>[s(d,{modelValue:e.pushWxUrl,"onUpdate:modelValue":t=>e.pushWxUrl=t,type:"text"},null,8,["modelValue","onUpdate:modelValue"])])),operate:r((({row:e})=>[F(e)?(n(),h(g,{key:0,content:"取消",onClick:S})):(n(),h(g,{key:1,content:"编辑",onClick:t=>(e=>{const t=_.value;t&&t.setEditRow(e)})(e)},null,8,["onClick"]))])),submit_item:r((()=>[s(g,{content:"查询",status:"primary",type:"submit"})])),reset_item:r((()=>[s(g,{content:"重置",type:"reset"})])),_:1},16),s(C,{modelValue:k.showEdit,"onUpdate:modelValue":t[0]||(t[0]=e=>k.showEdit=e),"before-hide-method":A,loading:k.submitLoading,"destroy-on-close":"",height:"800",resize:"","show-zoom":"",title:" 批量修改",width:"1000"},{default:r((()=>[s(U,{data:k.formData,"title-align":"right","title-width":"100",onSubmit:D},{default:r((()=>[s(v,{"item-render":{},span:12,field:"cityName",title:"区县"},{default:r((({data:e})=>[s(a,{modelValue:e.cityName,"onUpdate:modelValue":t=>e.cityName=t,options:N.list42,clearable:"",multiple:"",placeholder:"请选择区县",transfer:""},null,8,["modelValue","onUpdate:modelValue","options"])])),_:1}),s(v,{"item-render":{},span:12,field:"pushWxCode",title:"公众号id"},{default:r((({data:e})=>[s(o,{modelValue:e.pushWxCode,"onUpdate:modelValue":t=>e.pushWxCode=t,placeholder:"请输入公众号id",type:"text"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),s(v,{"item-render":{},span:12,field:"pushWxFirstValue",title:"公众号标题"},{default:r((({data:e})=>[s(o,{modelValue:e.pushWxFirstValue,"onUpdate:modelValue":t=>e.pushWxFirstValue=t,placeholder:"请输入公众号标题",type:"text"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),s(v,{"item-render":{},span:24,field:"phoneMsg",title:"短信内容"},{default:r((({data:e})=>[s(d,{modelValue:e.phoneMsg,"onUpdate:modelValue":t=>e.phoneMsg=t,autosize:{minRows:8,maxRows:20},placeholder:"请输入短信内容"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),s(v,{"item-render":{},span:12,field:"pushWxContent",title:"公众号类型"},{default:r((({data:e})=>[s(o,{modelValue:e.pushWxContent,"onUpdate:modelValue":t=>e.pushWxContent=t,placeholder:"请输入公众号类型",type:"text"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),s(v,{"item-render":{},span:12,field:"pushWxRemark",title:"公众号备注"},{default:r((({data:e})=>[s(o,{modelValue:e.pushWxRemark,"onUpdate:modelValue":t=>e.pushWxRemark=t,placeholder:"请输入公众号备注",type:"text"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),s(v,{"item-render":{},span:24,field:"pushWxUrl",title:"公众号链接"},{default:r((({data:e})=>[s(d,{modelValue:e.pushWxUrl,"onUpdate:modelValue":t=>e.pushWxUrl=t,autosize:{minRows:2,maxRows:10},placeholder:"请输入公众号链接"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),s(v,{"item-render":{},span:12,field:"type",title:"短信类型"},{default:r((({data:e})=>[s(a,{modelValue:e.type,"onUpdate:modelValue":t=>e.type=t,clearable:"",placeholder:"请选择类型"},{default:r((()=>[(n(!0),u(m,null,p(R.value,((e,t)=>(n(),h(l,{key:t,label:e.name,value:e.code},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),s(v,{span:24,align:"center","title-align":"left"},{default:r((()=>[s(g,{type:"submit"},{default:r((()=>[V("提交")])),_:1})])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue","loading"])])}}});export{_ as default};
