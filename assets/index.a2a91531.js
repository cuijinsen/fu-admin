var w=(e,t,s)=>new Promise((o,a)=>{var C=u=>{try{n(s.next(u))}catch(r){a(r)}},d=u=>{try{n(s.throw(u))}catch(r){a(r)}},n=u=>u.done?o(u.value):Promise.resolve(u.value).then(C,d);n((s=s.apply(e,t)).next())});import{n as h,r as V,a as N,b as S,v as P,f as v,cB as I,i as _,a9 as H,ay as $,aA as c,o as l,j as g,z as p,h as f,F as j,aD as R,m as b,bo as x,B as M,t as y,k as B,q as z,fR as U,dK as L,bq as G,s as q,fS as W,G as J}from"./index.01016e1b.js";import{T}from"./index.328b3892.js";import{B as Q}from"./index.d5369391.js";import{L as F}from"./index.3b3e88d2.js";/* empty css               */import{A as k}from"./index.460eb416.js";import{T as A}from"./index.ad15f2c8.js";import{T as X}from"./index.ffba2205.js";import"./useRefs.b8e07b47.js";import"./PlusOutlined.a86e82ec.js";import"./Col.d5380690.js";import"./useFlexGapSupport.0520fe90.js";import"./eagerComputed.19683db9.js";import"./useSize.368ff12a.js";var Y={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M816 768h-24V428c0-141.1-104.3-257.7-240-277.1V112c0-22.1-17.9-40-40-40s-40 17.9-40 40v38.9c-135.7 19.4-240 136-240 277.1v340h-24c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h216c0 61.8 50.2 112 112 112s112-50.2 112-112h216c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM512 888c-26.5 0-48-21.5-48-48h96c0 26.5-21.5 48-48 48zM304 768V428c0-55.6 21.6-107.8 60.9-147.1S456.4 220 512 220c55.6 0 107.8 21.6 147.1 60.9S720 372.4 720 428v340H304z"}}]},name:"bell",theme:"outlined"},Z=Y;function O(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?Object(arguments[t]):{},o=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(s).filter(function(a){return Object.getOwnPropertyDescriptor(s,a).enumerable}))),o.forEach(function(a){K(e,a,s[a])})}return e}function K(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var D=function(t,s){var o=O({},t,s.attrs);return h(V,O({},o,{icon:Z}),null)};D.displayName="BellOutlined";D.inheritAttrs=!1;var ee=D;const te=[{key:"1",name:"\u901A\u77E5",list:[]},{key:"2",name:"\u6D88\u606F",list:[{id:"000000006",avatar:"https://gw.alipayobjects.com/zos/rmsportal/fcHMVNCjPOsbUGdEduuv.jpeg",title:"\u66F2\u4E3D\u4E3D \u8BC4\u8BBA\u4E86\u4F60",description:"\u63CF\u8FF0\u4FE1\u606F\u63CF\u8FF0\u4FE1\u606F\u63CF\u8FF0\u4FE1\u606F",datetime:"2017-08-07",type:"2",clickClose:!0},{id:"000000007",avatar:"https://gw.alipayobjects.com/zos/rmsportal/fcHMVNCjPOsbUGdEduuv.jpeg",title:"\u6731\u504F\u53F3 \u56DE\u590D\u4E86\u4F60",description:"\u8FD9\u79CD\u6A21\u677F\u7528\u4E8E\u63D0\u9192\u8C01\u4E0E\u4F60\u53D1\u751F\u4E86\u4E92\u52A8",datetime:"2017-08-07",type:"2",clickClose:!0},{id:"000000008",avatar:"https://gw.alipayobjects.com/zos/rmsportal/fcHMVNCjPOsbUGdEduuv.jpeg",title:"\u6807\u9898",description:"\u8BF7\u5C06\u9F20\u6807\u79FB\u52A8\u5230\u6B64\u5904\uFF0C\u4EE5\u4FBF\u6D4B\u8BD5\u8D85\u957F\u7684\u6D88\u606F\u5728\u6B64\u5904\u5C06\u5982\u4F55\u5904\u7406\u3002\u672C\u4F8B\u4E2D\u8BBE\u7F6E\u7684\u63CF\u8FF0\u6700\u5927\u884C\u6570\u4E3A2\uFF0C\u8D85\u8FC72\u884C\u7684\u63CF\u8FF0\u5185\u5BB9\u5C06\u88AB\u7701\u7565\u5E76\u4E14\u53EF\u4EE5\u901A\u8FC7tooltip\u67E5\u770B\u5B8C\u6574\u5185\u5BB9",datetime:"2017-08-07",type:"2",clickClose:!0}]},{key:"3",name:"\u5F85\u529E",list:[{id:"000000009",avatar:"",title:"\u4EFB\u52A1\u540D\u79F0",description:"\u4EFB\u52A1\u9700\u8981\u5728 2017-01-12 20:00 \u524D\u542F\u52A8",datetime:"",extra:"\u672A\u5F00\u59CB",color:"",type:"3"},{id:"000000010",avatar:"",title:"\u7B2C\u4E09\u65B9\u7D27\u6025\u4EE3\u7801\u53D8\u66F4",description:"\u51A0\u9716 \u9700\u5728 2017-01-07 \u524D\u5B8C\u6210\u4EE3\u7801\u53D8\u66F4\u4EFB\u52A1",datetime:"",extra:"\u9A6C\u4E0A\u5230\u671F",color:"red",type:"3"},{id:"000000011",avatar:"",title:"\u4FE1\u606F\u5B89\u5168\u8003\u8BD5",description:"\u6307\u6D3E\u7AF9\u5C14\u4E8E 2017-01-09 \u524D\u5B8C\u6210\u66F4\u65B0\u5E76\u53D1\u5E03",datetime:"",extra:"\u5DF2\u8017\u65F6 8 \u5929",color:"gold",type:"3"},{id:"000000012",avatar:"",title:"ABCD \u7248\u672C\u53D1\u5E03",description:"\u6307\u6D3E\u7AF9\u5C14\u4E8E 2017-01-09 \u524D\u5B8C\u6210\u66F4\u65B0\u5E76\u53D1\u5E03",datetime:"",extra:"\u8FDB\u884C\u4E2D",color:"blue",type:"3"}]}];const se=N({components:{[k.name]:k,[F.name]:F,[F.Item.name]:F.Item,AListItemMeta:F.Item.Meta,ATypographyParagraph:X.Paragraph,[A.name]:A},props:{list:{type:Array,default:()=>[]},pageSize:{type:[Boolean,Number],default:5},currentPage:{type:Number,default:1},titleRows:{type:Number,default:1},descRows:{type:Number,default:2},onTitleClick:{type:Function}},emits:["update:currentPage"],setup(e,{emit:t}){const{prefixCls:s}=S("header-notify-list"),o=P(e.currentPage||1),a=v(()=>{const{pageSize:u,list:r}=e;if(u===!1)return[];let m=I(u)?u:5;return r.slice(m*(_(o)-1),m*_(o))});H(()=>e.currentPage,u=>{o.value=u});const C=v(()=>!!e.onTitleClick),d=v(()=>{const{list:u,pageSize:r}=e;return r>0&&u&&u.length>r?{total:u.length,pageSize:r,current:_(o),onChange(m){o.value=m,t("update:currentPage",m)}}:!1});function n(u){e.onTitleClick&&e.onTitleClick(u)}return{prefixCls:s,getPagination:d,getData:a,handleTitleClick:n,isTitleClickable:C}}}),oe={class:"title"},ue={key:0,class:"extra"},ie={key:1},ne={key:0,class:"description"},ae={class:"datetime"};function re(e,t,s,o,a,C){const d=c("a-typography-paragraph"),n=c("a-tag"),u=c("a-avatar"),r=c("a-list-item-meta"),m=c("a-list-item"),E=c("a-list");return l(),g(E,{class:z(e.prefixCls),bordered:"",pagination:e.getPagination},{default:p(()=>[(l(!0),f(j,null,R(e.getData,i=>(l(),g(m,{key:i.id,class:"list-item"},{default:p(()=>[h(r,null,{title:p(()=>[b("div",oe,[h(d,{onClick:ge=>e.handleTitleClick(i),style:x([{width:"100%","margin-bottom":"0 !important"},{cursor:e.isTitleClickable?"pointer":""}]),delete:!!i.titleDelete,ellipsis:e.$props.titleRows&&e.$props.titleRows>0?{rows:e.$props.titleRows,tooltip:!!i.title}:!1,content:i.title},null,8,["onClick","style","delete","ellipsis","content"]),i.extra?(l(),f("div",ue,[h(n,{class:"tag",color:i.color},{default:p(()=>[M(y(i.extra),1)]),_:2},1032,["color"])])):B("",!0)])]),avatar:p(()=>[i.avatar?(l(),g(u,{key:0,class:"avatar",src:i.avatar},null,8,["src"])):(l(),f("span",ie,y(i.avatar),1))]),description:p(()=>[b("div",null,[i.description?(l(),f("div",ne,[h(d,{style:{width:"100%","margin-bottom":"0 !important"},ellipsis:e.$props.descRows&&e.$props.descRows>0?{rows:e.$props.descRows,tooltip:!!i.description}:!1,content:i.description},null,8,["ellipsis","content"])])):B("",!0),b("div",ae,y(i.datetime),1)])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["class","pagination"])}var le=$(se,[["render",re],["__scopeId","data-v-737c3776"]]);class ce{constructor(){this.timeout=5e3}reset(){clearTimeout(this.heartTimeOut),clearTimeout(this.ServerHeartTimeOut)}start(t){this.heartTimeOut=setTimeout(s=>{t(s),this.ServerHeartTimeOut=setTimeout(o=>{t(o),this.reset(),this.start(t)},this.timeout)},this.timeout)}}class pe extends ce{constructor(t){super(),this.reconnectTimer=0,this.reconnectCount=10,this.options={url:null,heartTime:5e3,heartMsg:"ping",isReconnect:!0,isRestory:!1,reconnectTime:5e3,reconnectCount:5,openCb:s=>{},closeCb:s=>{},messageCb:s=>{},errorCb:s=>{}},Object.assign(this.options,t),this.create()}create(){if(!("WebSocket"in window))throw new Error("\u5F53\u524D\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\uFF0C\u65E0\u6CD5\u4F7F\u7528");if(!this.options.url)throw new Error("\u5730\u5740\u4E0D\u5B58\u5728\uFF0C\u65E0\u6CD5\u5EFA\u7ACB\u901A\u9053");this.ws=new WebSocket(this.options.url),this.onopen(this.options.openCb),this.onclose(this.options.closeCb),this.onmessage(this.options.messageCb)}onopen(t){this.ws.onopen=s=>{clearTimeout(this.reconnectTimer),this.options.reconnectCount=this.reconnectCount,super.reset(),super.start(()=>{this.send(this.options.heartMsg)}),typeof t=="function"?t(s):typeof this.options.openCb=="function"&&this.options.openCb(s)}}onclose(t){this.ws.onclose=s=>{super.reset(),!this.options.isRestory&&this.onreconnect(),typeof t=="function"?t(s):typeof this.options.closeCb=="function"&&this.options.closeCb(s)}}onerror(t){this.ws.onerror=s=>{typeof t=="function"?t(s):typeof this.options.errorCb=="function"&&this.options.errorCb(s)}}onmessage(t){this.ws.onmessage=s=>{const o=s.data;o?(super.reset(),super.start(()=>{this.send(this.options.heartMsg)}),typeof t=="function"?t(o):typeof this.options.messageCb=="function"&&this.options.messageCb(o)):U.error("\u6536\u5230\u5931\u8D25\u7684\u6570\u636E\uFF01")}}send(t){if(this.ws.readyState!==this.ws.OPEN)throw new Error("\u6CA1\u6709\u8FDE\u63A5\u5230\u670D\u52A1\u5668\uFF0C\u65E0\u6CD5\u63A8\u9001");t=JSON.stringify(t),this.ws.send(t)}onreconnect(){this.options.reconnectCount>0||this.options.reconnectCount===-1?this.reconnectTimer=window.setTimeout(()=>{this.create(),this.options.reconnectCount!==-1&&this.options.reconnectCount--},this.options.reconnectTime):(clearTimeout(this.reconnectTimer),this.options.reconnectCount=this.reconnectCount)}destroy(){super.reset(),clearTimeout(this.reconnectTimer),this.options.isRestory=!0,this.ws.close()}}function de(e){return L.get({url:"/system/message/getNoticeListData",params:e})}function me(e){return L.get({url:"/system/message/changeNoticeRead",params:e})}const he=N({components:{Popover:G,BellOutlined:ee,Tabs:T,TabPane:T.TabPane,Badge:Q,NoticeList:le},setup(){const e=q().getUserInfo.userId,{prefixCls:t}=S("header-notify"),{createMessage:s}=J(),o=_(te),a=P(0);de({id:e}).then(n=>{o[0].list=n,o[0].list&&o[0].list.length&&o[0].list.forEach(()=>{a.value++})}),new pe({url:"ws://localhost:2800/api/websocket/"+e}).onmessage(n=>{W.info({message:n,description:""}),a.value++});function d(n){return w(this,null,function*(){s.success(+n.id+"\u53F7\u6D88\u606F\u5DF2\u8BFB"),n.titleDelete=!n.titleDelete,o[0].list=o[0].list.filter(u=>u.id!==n.id),yield me({id:n.id}).then(u=>{n.titleDelete?a.value--:a.value++}),o[0].list})}return{prefixCls:t,listData:o,count:a,onNoticeClick:d,numberStyle:{}}}}),fe={key:0};function Ce(e,t,s,o,a,C){const d=c("BellOutlined"),n=c("Badge"),u=c("NoticeList"),r=c("TabPane"),m=c("Tabs"),E=c("Popover");return l(),f("div",{class:z(e.prefixCls)},[h(E,{title:"",trigger:"click",overlayClassName:`${e.prefixCls}__overlay`},{content:p(()=>[h(m,null,{default:p(()=>[(l(!0),f(j,null,R(e.listData,i=>(l(),g(r,{key:i.key},{tab:p(()=>[M(y(i.name)+" ",1),i.list.length!==0?(l(),f("span",fe,"("+y(i.list.length)+")",1)):B("",!0)]),default:p(()=>[i.key==="1"?(l(),g(u,{key:0,list:i.list,onTitleClick:e.onNoticeClick},null,8,["list","onTitleClick"])):(l(),g(u,{key:1,list:i.list},null,8,["list"]))]),_:2},1024))),128))]),_:1})]),default:p(()=>[h(n,{count:e.count,numberStyle:e.numberStyle,offset:[-5,15]},{default:p(()=>[h(d)]),_:1},8,["count","numberStyle"])]),_:1},8,["overlayClassName"])],2)}var Pe=$(he,[["render",Ce]]);export{Pe as default};
