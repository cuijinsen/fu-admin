var e=Object.defineProperty,o=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,d=(o,a,t)=>a in o?e(o,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[a]=t,i=(e,o)=>{for(var a in o||(o={}))l.call(o,a)&&d(e,a,o[a]);if(t)for(var a of t(o))n.call(o,a)&&d(e,a,o[a]);return e},r=(e,t)=>o(e,a(t)),p=(e,o,a)=>new Promise(((t,l)=>{var n=e=>{try{i(a.next(e))}catch(o){l(o)}},d=e=>{try{i(a.throw(e))}catch(o){l(o)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,d);i((a=a.apply(e,o)).next())}));import{b as s,B as c}from"./index-b361c612.js";import{k as m,B as u,c as h}from"./useForm-39f6e704.js";import{cR as f,a as y,s as v,e as b,h as P,o as C,i as I,y as g,m as x,l as w,t as S,aG as F,E as N}from"./index-d32d699d.js";import{s as j}from"./index-2e5c6a76.js";import{s as A}from"./sysAreaApi-e41d1f2f.js";import{b as k,v as O,c as q,e as _}from"./sysDeptApi-2c1e26d4.js";const M=[{title:"部门名称",dataIndex:"deptName",width:120},{title:"部门全称",dataIndex:"deptFullname",width:150},{title:"机构类型",dataIndex:"orgType",width:120},{title:"负责人",dataIndex:"leader",width:120},{title:"负责人电话",dataIndex:"leaderPhone",width:120},{title:"办公电话",dataIndex:"phone",width:120},{title:"邮箱",dataIndex:"email",width:120},{title:"邮政编码",dataIndex:"postCode",width:120},{title:"联系地址",dataIndex:"address",width:120},{title:"排序",dataIndex:"sort",width:80},{title:"状态",dataIndex:"sysStatus",width:80},{title:"备注",dataIndex:"remarks"},{title:"所属市",dataIndex:"city",width:60},{title:"所属区",dataIndex:"district",width:60}],T=[{field:"deptName",label:"部门名称",component:"Input",componentProps:{placeholder:"请输入部门名称"}},{field:"deptFullname",label:"部门全称",component:"Input",componentProps:{placeholder:"请输入部门全称"}},{field:"province",component:"ApiSelect",label:"省份",colProps:{span:8},componentProps:({formModel:e,formActionType:o})=>({params:{parentCode:"0"},labelField:"areaName",valueField:"areaCode",api:A,placeholder:"请选择省份",onChange:a=>p(void 0,null,(function*(){let t;yield A({parentCode:a}).then((e=>{t=e.map((e=>({id:e.areaCode,label:e.areaName,value:e.areaCode,key:e.areaCode})))}));const l=void 0!==a?t:[];e.city=void 0,e.district=void 0;const{updateSchema:n}=o;yield n({field:"city",componentProps:{placeholder:"请先选择省份",options:l,onChange:a=>p(void 0,null,(function*(){let t;yield A({parentCode:a}).then((e=>{t=e.map((e=>({id:e.areaCode,label:e.areaName,value:e.areaCode,key:e.areaCode})))}));const l=void 0!==a?t:[];e.district=void 0;const{updateSchema:n}=o;yield n({field:"district",componentProps:{options:l}})}))}})}))})},{field:"city",component:"Select",label:"城市",colProps:{span:8},componentProps:({formModel:e})=>({placeholder:"请先选择省份",options:[],onChange:()=>p(void 0,null,(function*(){e.district=void 0}))})},{field:"district",component:"Select",label:"区县",colProps:{span:8},componentProps:{options:[],placeholder:"请先选择城市"}}],R=[{field:"province",component:"ApiSelect",label:"省份",colProps:{span:8},componentProps:({formModel:e,formActionType:o})=>({params:{parentCode:"0"},labelField:"areaName",valueField:"areaCode",api:A,placeholder:"请选择省份",onChange:a=>p(void 0,null,(function*(){let t;yield A({parentCode:a}).then((e=>{t=e.map((e=>({id:e.areaCode,label:e.areaName,value:e.areaCode,key:e.areaCode})))}));const l=void 0!==a?t:[];e.city=void 0,e.district=void 0;const{updateSchema:n}=o;yield n({field:"city",componentProps:{placeholder:"请先选择省份",options:l,onChange:a=>p(void 0,null,(function*(){let t;yield A({parentCode:a}).then((e=>{t=e.map((e=>({id:e.areaCode,label:e.areaName,value:e.areaCode,key:e.areaCode})))}));const l=void 0!==a?t:[];e.district=void 0;const{updateSchema:n}=o;yield n({field:"district",componentProps:{options:l}})}))}})}))})},{field:"city",component:"Select",label:"城市",required:!0,colProps:{span:8},componentProps:({formModel:e})=>({placeholder:"请先选择省份",options:[],onChange:()=>p(void 0,null,(function*(){e.district=void 0}))})},{field:"district",component:"Select",label:"区县",required:!0,colProps:{span:8},componentProps:{options:[],placeholder:"请先选择城市"}},{field:"deptName",label:"部门名称",component:"Input",required:!0,componentProps:{placeholder:"请输入部门名称",maxlength:100}},{field:"deptFullname",label:"部门全称",component:"AutoComplete",itemProps:{validateTrigger:"blur"},slot:"deptFullname",required:!0},{field:"standardName",label:"部门标准名称",component:"Input",required:!0,ifShow:({values:e})=>"1406957304434958338"===e.parentId},{field:"mapId",label:"地图Id",component:"Input",show:!1,componentProps:{placeholder:"请输入地图Id"}},{field:"location",label:"经纬度",component:"Input",show:!1,componentProps:{placeholder:"请输入经纬度"}},{field:"orgType",label:"机构类型",component:"ApiRadioGroup",required:!0,componentProps:{api:j,params:{dictCode:"sys_org_type"}},defaultValue:"2"},{field:"parentId",label:"上级部门",component:"TreeSelect",componentProps:{placeholder:"请选择上级部门",fieldNames:{label:"name",key:"id",value:"id"},getPopupContainer:()=>document.body}},{field:"leader",label:"负责人",component:"Input",componentProps:{placeholder:"请输入负责人",maxlength:30}},{field:"leaderPhone",label:"负责人电话",component:"Input",componentProps:{placeholder:"请输入负责人电话",maxlength:30}},{field:"phone",label:"办公电话",component:"Input",componentProps:{placeholder:"请输入办公电话",maxlength:30}},{field:"email",label:"邮箱",component:"Input",componentProps:{placeholder:"请输入邮箱",maxlength:100}},{field:"postCode",label:"邮政编码",component:"Input",componentProps:{placeholder:"请输入邮政编码",maxlength:30}},{field:"address",label:"联系地址",component:"InputTextArea",componentProps:{placeholder:"请输入联系地址",maxlength:500}},{field:"sort",label:"排序",component:"InputNumber",required:!0,defaultValue:"1",componentProps:{placeholder:"请输入排序",min:1}},{field:"sysStatus",label:"状态",component:"ApiRadioGroup",required:!0,componentProps:{api:j,params:{dictCode:"sys_status"}},defaultValue:"0"},{label:"备注",field:"remarks",component:"InputTextArea",componentProps:{placeholder:"请输入备注",maxlength:500}},{label:"覆盖范围",field:"distance",component:"Input",required:!0,suffix:"公里",componentProps:{placeholder:"请输入覆盖范围"},defaultValue:"5"}];const V={style:{display:"flex","justify-content":"space-between"}},G=y({__name:"FormModal",emits:["success","register"],setup(e,{emit:o}){const a=v([]),t=b((()=>P(l)?"编辑部门":"新增部门")),l=v(!1),n=v(),d=v(""),{createMessage:y}=N(),[j,{getFieldsValue:M,setFieldsValue:T,resetFields:G,validate:B,updateSchema:D}]=m({labelWidth:100,schemas:R,showActionButtonGroup:!1,actionColOptions:{span:23},baseColProps:{lg:12,md:24}}),[E,{setModalProps:L,closeModal:U}]=s((e=>p(this,null,(function*(){yield G(),L({confirmLoading:!1}),l.value=!!(null==e?void 0:e.isUpdate);const o=yield k({nodeId:e.record.id});if(yield D([{field:"parentId",componentProps:{treeData:o}}]),P(l)){n.value=e.record.id;const o=yield O({id:e.record.id}),[a,t]=yield Promise.all([A({parentCode:o.province}),A({parentCode:o.city})]),l=a.map((e=>({id:e.areaCode,label:e.areaName,value:e.areaCode,key:e.areaCode}))),p=t.map((e=>({id:e.areaCode,label:e.areaName,value:e.areaCode,key:e.areaCode})));yield Promise.all([D([{field:"city",componentProps:{options:l}},{field:"district",componentProps:{options:p}}]),T(r(i({},o),{parentId:"0"===o.parentId?null:o.parentId}))]),d.value=o.deptFullname}else yield T({parentId:e.record.parentId})})))),W=(e,o)=>{T({deptFullname:e}),T({location:o.location}),T({address:o.address}),T({phone:o.tel}),T({mapId:o.id})},$=e=>p(this,null,(function*(){let o=M();var t;yield(t={keywords:e,city:o.city},f.post({url:"/system/location/getPoi",params:t})).then((e=>{a.value=[],e.forEach((e=>{a.value.push({id:e.id,name:e.name,value:e.name,location:e.location,address:e.address,tel:e.tel})}))}))}));function z(){return p(this,null,(function*(){try{const e=yield B();L({confirmLoading:!0}),P(l)?yield _(r(i({},e),{id:n.value})):yield q(i({},e)),P(l)?y.success("编辑成功！"):y.success("新增成功！"),U(),o("success",{isUpdate:P(l),values:r(i({},e),{id:n.value})})}finally{L({confirmLoading:!1})}}))}return(e,o)=>(C(),I(P(c),F({title:t.value,destroyOnClose:""},e.$attrs,{width:"1000px",onOk:z,onRegister:P(E)}),{default:g((()=>[x(P(u),{onRegister:P(j)},{deptFullname:g((()=>[x(P(h),{value:d.value,"onUpdate:value":o[0]||(o[0]=e=>d.value=e),options:a.value,placeholder:"请输入部门全称并选择",onSearch:$,onSelect:W},{option:g((e=>[w("div",V,[w("span",null,S(e.name),1),w("span",null,S(e.location),1)])])),_:1},8,["value","options"])])),_:1},8,["onRegister"])])),_:1},16,["title","onRegister"]))}});export{G as _,M as c,T as s};
