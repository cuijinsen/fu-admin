var T=Object.defineProperty,A=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var B=(u,t,e)=>t in u?T(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e,F=(u,t)=>{for(var e in t||(t={}))R.call(t,e)&&B(u,e,t[e]);if(D)for(var e of D(t))j.call(t,e)&&B(u,e,t[e]);return u},h=(u,t)=>A(u,N(t));var I=(u,t,e)=>new Promise((r,n)=>{var f=s=>{try{m(e.next(s))}catch(d){n(d)}},i=s=>{try{m(e.throw(s))}catch(d){n(d)}},m=s=>s.done?r(s.value):Promise.resolve(s.value).then(f,i);m((e=e.apply(u,t)).next())});import{a as q,B as K}from"./index.296b7df0.js";import{B as L}from"./BasicForm.1111a937.js";import{u as V}from"./useForm.e97ebf24.js";import{a as W,f as G,i as o,v as p,br as U,o as z,j as $,z as b,n as w,aB as H,G as J}from"./index.7f67491a.js";import{_ as Q}from"./index.609a5c7f.js";import{s as _}from"./index.f816d15d.js";import{s as X,a as Y,e as Z}from"./sysRoleApi.3c672093.js";import{s as ee}from"./sysDeptApi.d6458184.js";const pe=[{title:"\u89D2\u8272\u540D\u79F0",dataIndex:"roleName",width:150,align:"left"},{title:"\u89D2\u8272\u7F16\u7801",dataIndex:"roleCode",width:150,align:"left"},{title:"\u6570\u636E\u8303\u56F4",dataIndex:"dataScope",width:150},{title:"\u6392\u5E8F",dataIndex:"sort",width:90},{title:"\u72B6\u6001",dataIndex:"status",width:80},{title:"\u5907\u6CE8",dataIndex:"remarks"},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createTime",width:160},{title:"\u66F4\u65B0\u65F6\u95F4",dataIndex:"updateTime",width:160}],me=[{field:"roleName",label:"\u89D2\u8272\u540D\u79F0",component:"Input",componentProps:{placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"}},{field:"roleCode",label:"\u89D2\u8272\u7F16\u7801",component:"Input",componentProps:{placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u7F16\u7801"}}],te=[{field:"roleName",label:"\u89D2\u8272\u540D\u79F0",component:"Input",required:!0,componentProps:{placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",maxlength:100}},{field:"roleCode",label:"\u89D2\u8272\u7F16\u7801",component:"Input",required:!0,componentProps:{placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u7F16\u7801",maxlength:100}},{field:"dataScope",label:"\u6570\u636E\u8303\u56F4",component:"ApiSelect",required:!0,componentProps:{placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u8303\u56F4",api:_,params:{dictCode:"sys_data_scope"}}},{field:"deptIds",label:"\u6570\u636E\u6743\u9650",slot:"deptIds",component:"Input",ifShow:({values:u})=>u.dataScope==="2"},{field:"sort",label:"\u6392\u5E8F",component:"InputNumber",required:!0,defaultValue:"1",componentProps:{placeholder:"\u8BF7\u8F93\u5165\u6392\u5E8F",min:1}},{field:"status",label:"\u72B6\u6001",component:"ApiRadioGroup",required:!0,componentProps:{api:_,params:{dictCode:"sys_status"}},defaultValue:"0"},{label:"\u5907\u6CE8",field:"remarks",component:"InputTextArea",componentProps:{placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",maxlength:500}}],ue=W({__name:"FormModal",emits:["success","register"],setup(u,{emit:t}){const e=G(()=>o(r)?"\u7F16\u8F91\u89D2\u8272":"\u65B0\u589E\u89D2\u8272"),r=p(!1),n=p(),f=p([]),i=p([]),m=p([]),s=p(new Set),d=p(!1);U(()=>{O()});const{createMessage:g}=J(),[y,{setFieldsValue:C,resetFields:E,validate:k}]=V({labelWidth:100,schemas:te,showActionButtonGroup:!1,actionColOptions:{span:23},baseColProps:{span:24}}),[x,{setModalProps:v,closeModal:S}]=q(a=>I(this,null,function*(){if(yield E(),v({confirmLoading:!1}),r.value=!!(a!=null&&a.isUpdate),o(r)){n.value=a.record.id;const l=yield X({roleId:n.value});s.value=new Set(l.filter(c=>c.parentId!=="0").map(c=>c.parentId)),s.value,i.value=l.filter(c=>!s.value.has(c.id)).map(c=>c.id),yield C(F({},a.record))}}));function M(){return I(this,null,function*(){try{const a=yield k();v({confirmLoading:!0});const l=o(d)?[...i.value,...m.value]:[...i.value,...Array.from(s.value)];o(r)?yield Z(h(F({},a),{id:n.value,deptIds:l})):yield Y(h(F({},a),{deptIds:l})),o(r)?g.success("\u7F16\u8F91\u6210\u529F\uFF01"):g.success("\u65B0\u589E\u6210\u529F\uFF01"),S(),t("success",{isUpdate:o(r),values:h(F({},a),{id:n.value,deptIds:l})})}finally{v({confirmLoading:!1})}})}function P(a,l){o(d)||(d.value=!0),i.value=a,m.value=l.halfCheckedKeys}function O(){return I(this,null,function*(){f.value=yield ee()})}return(a,l)=>(z(),$(o(K),H(a.$attrs,{destroyOnClose:"",onRegister:o(x),title:o(e),onOk:M}),{default:b(()=>[w(o(L),{onRegister:o(y)},{deptIds:b(()=>[w(o(Q),{checkedKeys:i.value,treeData:f.value,checkable:"",onCheck:P,title:"\u9009\u62E9\u90E8\u95E8",fieldNames:{key:"id",title:"name"}},null,8,["checkedKeys","treeData"])]),_:1},8,["onRegister"])]),_:1},16,["onRegister","title"]))}});var Fe=Object.freeze(Object.defineProperty({__proto__:null,default:ue},Symbol.toStringTag,{value:"Module"}));export{Fe as F,ue as _,pe as c,me as s};
