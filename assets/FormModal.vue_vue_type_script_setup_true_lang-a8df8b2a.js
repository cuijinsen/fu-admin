var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,r=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&i(e,a,t[a]);if(o)for(var a of o(t))n.call(t,a)&&i(e,a,t[a]);return e},d=(e,o)=>t(e,a(o)),s=(e,t,a)=>new Promise(((o,l)=>{var n=e=>{try{r(a.next(e))}catch(t){l(t)}},i=e=>{try{r(a.throw(e))}catch(t){l(t)}},r=e=>e.done?o(e.value):Promise.resolve(e.value).then(n,i);r((a=a.apply(e,t)).next())}));import{b as p,B as u}from"./index-b361c612.js";import{k as m,B as c}from"./useForm-39f6e704.js";import{a as f,e as h,h as y,s as b,o as v,i as x,y as I,m as w,aG as P,E as k}from"./index-d32d699d.js";import{s as g}from"./index-2e5c6a76.js";import{a as S,v as T,b as q,e as O}from"./sysMenuApi-b7b39e4b.js";const _=e=>"menu"===e,j=e=>"button"===e,C=e=>"0"===e,E=[{title:"菜单名称",dataIndex:"menuName",width:120},{title:"菜单类型",dataIndex:"menuType",width:80},{title:"排序",dataIndex:"sort",width:80},{title:"状态",dataIndex:"sysStatus",width:80},{title:"图标",dataIndex:"icon",width:50},{title:"是否显示",dataIndex:"visible",width:80},{title:"是否缓存",dataIndex:"keepalive",width:80},{title:"路由地址",dataIndex:"routePath",width:120},{title:"组件路径",dataIndex:"component",width:200,align:"left"},{title:"权限标识",dataIndex:"permission",width:180,align:"left"},{title:"是否外链",dataIndex:"linkExternal",width:80},{title:"是否内嵌",dataIndex:"frame",width:80},{title:"外部链接",dataIndex:"linkUrl",width:120},{title:"备注",dataIndex:"remarks"}],R=[{field:"menuName",label:"菜单名称",component:"Input",componentProps:{placeholder:"请输入菜单名称"}}],A=[{field:"menuType",label:"菜单类型",component:"ApiRadioGroup",required:!0,componentProps:{api:g,params:{dictCode:"sys_menu_type"},isBtn:!0},defaultValue:"dir"},{field:"menuName",label:"菜单名称",component:"Input",required:!0,componentProps:{placeholder:"请输入菜单名称",maxlength:100}},{field:"parentId",label:"上级菜单",component:"TreeSelect",componentProps:{placeholder:"请选择上级菜单",fieldNames:{label:"name",key:"id",value:"id"},getPopupContainer:()=>document.body}},{field:"sort",label:"排序",component:"InputNumber",required:!0,defaultValue:"1",componentProps:{placeholder:"请输入排序",min:1}},{field:"sysStatus",label:"状态",component:"ApiRadioGroup",required:!0,componentProps:{api:g,params:{dictCode:"sys_status"}},defaultValue:"0"},{label:"备注",field:"remarks",component:"InputTextArea",componentProps:{placeholder:"请输入备注",maxlength:500}},{field:"icon",label:"图标",component:"IconPicker",ifShow:({values:e})=>!j(e.menuType)},{field:"visible",label:"是否显示",component:"ApiRadioGroup",required:!0,componentProps:{api:g,params:{dictCode:"sys_visible"}},defaultValue:"0",ifShow:({values:e})=>"dir"===e.menuType||_(e.menuType)},{field:"routePath",label:"路由地址",component:"Input",required:!0,componentProps:{placeholder:"请输入路由地址"},ifShow:({values:e})=>!j(e.menuType)},{field:"component",label:"组件路径",component:"Input",required:!0,componentProps:{placeholder:"请输入组件路径"},ifShow:({values:e})=>_(e.menuType)&&!C(e.linkExternal)},{field:"linkUrl",label:"外部链接",component:"Input",required:!0,componentProps:{placeholder:"请输入外部链接"},ifShow:({values:e})=>_(e.menuType)&&C(e.linkExternal)},{field:"keepalive",label:"是否缓存",component:"ApiRadioGroup",required:!0,componentProps:{api:g,params:{dictCode:"sys_keepalive"}},defaultValue:"0",ifShow:({values:e})=>_(e.menuType)},{field:"permission",label:"权限标识",component:"Input",required:!0,componentProps:{placeholder:"请输入权限标识"},ifShow:({values:e})=>j(e.menuType)},{field:"linkExternal",label:"是否外链",component:"ApiRadioGroup",required:!0,componentProps:{api:g,params:{dictCode:"sys_link_external"}},defaultValue:"1",ifShow:({values:e})=>_(e.menuType)},{field:"frame",label:"是否内嵌",component:"ApiRadioGroup",required:!0,componentProps:{api:g,params:{dictCode:"sys_frame"}},defaultValue:"0",ifShow:({values:e})=>_(e.menuType)&&C(e.linkExternal)}],G=f({__name:"FormModal",emits:["success","register"],setup(e,{emit:t}){const a=h((()=>y(o)?"编辑菜单":"新增菜单")),o=b(!1),l=b(),{createMessage:n}=k(),[i,{setFieldsValue:f,updateSchema:g,resetFields:_,validate:j}]=m({labelWidth:100,schemas:A,showActionButtonGroup:!1,baseColProps:{lg:12,md:24},actionColOptions:{span:23}}),[C,{setModalProps:E,closeModal:R}]=p((e=>s(this,null,(function*(){yield _(),E({confirmLoading:!1}),o.value=!!(null==e?void 0:e.isUpdate);const t=yield S({nodeId:e.record.id});if(yield g([{field:"parentId",componentProps:{treeData:t}}]),y(o)){l.value=e.record.id;const t=yield T({id:e.record.id});yield f(d(r({},t),{parentId:"0"===t.parentId?null:t.parentId,visible:t.visible?t.visible:"0",keepalive:t.keepalive?t.keepalive:"0",linkExternal:t.linkExternal?t.linkExternal:"1",frame:t.frame?t.frame:"0"}))}else yield f({parentId:e.record.parentId})}))));function G(){return s(this,null,(function*(){try{const e=yield j();E({confirmLoading:!0}),y(o)?yield O(d(r({},e),{id:l.value})):yield q(r({},e)),y(o)?n.success("编辑成功！"):n.success("新增成功！"),R(),t("success",{isUpdate:y(o),values:d(r({},e),{id:l.value})})}finally{E({confirmLoading:!1})}}))}return(e,t)=>(v(),x(y(u),P(e.$attrs,{destroyOnClose:"",onRegister:y(C),title:a.value,onOk:G,width:"900px"}),{default:I((()=>[w(y(c),{onRegister:y(i)},null,8,["onRegister"])])),_:1},16,["onRegister","title"]))}});export{G as _,E as c,R as s};
