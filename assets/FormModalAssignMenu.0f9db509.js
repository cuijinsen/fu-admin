var d=(h,p,s)=>new Promise((r,e)=>{var f=a=>{try{t(s.next(a))}catch(i){e(i)}},l=a=>{try{t(s.throw(a))}catch(i){e(i)}},t=a=>a.done?r(a.value):Promise.resolve(a.value).then(f,l);t((s=s.apply(h,p)).next())});import{a as _,B as D}from"./index.296b7df0.js";import{a as I,v as u,br as w,o as B,j as F,z as K,n as S,i as m,aB as b,G as A}from"./index.7f67491a.js";import{_ as L}from"./index.609a5c7f.js";import{s as O}from"./sysMenuApi.67f30176.js";import{s as T,b as R}from"./sysRoleApi.3c672093.js";import"./useWindowSizeFn.8bbcad12.js";import"./FullscreenOutlined.505d9d0b.js";import"./fromPairs.84aabb58.js";import"./index.1db504fc.js";import"./eagerComputed.e27f22e8.js";import"./useContextMenu.a054c63d.js";import"./index.a655c1dc.js";import"./get.c67596ea.js";const U=I({__name:"FormModalAssignMenu",emits:["success","register"],setup(h,{emit:p}){const s=u([]),r=u(),e=u([]),f=u([]),l=u(new Set),t=u(!1);w(()=>{C()});const{createMessage:a,createConfirm:i}=A(),[g,{setModalProps:v,closeModal:y}]=_(o=>d(this,null,function*(){v({confirmLoading:!1}),r.value=o.record.id;const c=yield T({roleId:r.value});l.value=new Set(c.filter(n=>n.parentId!=="0").map(n=>n.parentId)),l.value,e.value=c.filter(n=>!l.value.has(n.id)).map(n=>n.id),e.value}));function k(o,c){m(t)||(t.value=!0),e.value=o,f.value=c.halfCheckedKeys}function M(){return d(this,null,function*(){try{i({iconType:"warning",title:"\u63D0\u793A",content:"\u786E\u8BA4\u5206\u914D\u83DC\u5355\uFF1F",onOk:()=>d(this,null,function*(){v({confirmLoading:!0});const o=m(t)?[...e.value,...f.value]:[...e.value,...Array.from(l.value)];yield R({menuIds:o,roleId:r.value}),a.success("\u5206\u914D\u6210\u529F\uFF01"),y(),p("success",r.value)})})}finally{v({confirmLoading:!1})}})}function C(){return d(this,null,function*(){s.value=yield O()})}return(o,c)=>(B(),F(m(D),b(o.$attrs,{destroyOnClose:"",onRegister:m(g),title:"\u5206\u914D\u83DC\u5355",onOk:M}),{default:K(()=>[S(m(L),{checkedKeys:e.value,treeData:s.value,checkable:"",onCheck:k,fieldNames:{key:"id",title:"name"}},null,8,["checkedKeys","treeData"])]),_:1},16,["onRegister"]))}});export{U as default};
