var e=Object.defineProperty,o=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,i=(o,t,r)=>t in o?e(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,n=(e,o)=>{for(var t in o||(o={}))l.call(o,t)&&i(e,t,o[t]);if(r)for(var t of r(o))a.call(o,t)&&i(e,t,o[t]);return e},d=(e,r)=>o(e,t(r)),s=(e,o,t)=>new Promise(((r,l)=>{var a=e=>{try{n(t.next(e))}catch(o){l(o)}},i=e=>{try{n(t.throw(e))}catch(o){l(o)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,i);n((t=t.apply(e,o)).next())}));import{b as p,B as c}from"./index-b361c612.js";import{k as u,B as m}from"./useForm-39f6e704.js";import{bV as f,a as b,e as h,h as v,s as P,r as y,o as I,i as x,y as g,m as w,aG as j,E as O}from"./index-d32d699d.js";import{v as A,a as C,e as S}from"./productApi-29a579d7.js";import{T as N}from"./index-280a19eb.js";import{a as R,s as k}from"./index-2e5c6a76.js";const B=[{title:"商品Id",dataIndex:"id",width:120},{title:"商品名称",dataIndex:"productName",width:120},{title:"商品描述",dataIndex:"productDesc",width:120},{title:"商品图片",dataIndex:"imgAddr",width:120},{title:"正常价格",dataIndex:"normalPrice",width:80},{title:"打折价格",dataIndex:"promotionPrice",width:80},{title:"商品库存",dataIndex:"stock",width:80},{title:"是否上架",dataIndex:"enableStatus",customRender:({record:e})=>{const o=1==~~e.enableStatus,t=o?"已上架":"未上架";return f(N,{color:o?"green":"red"},(()=>t))},width:80},{title:"审核状态",dataIndex:"priority",width:80,customRender:({record:e})=>{const o=1==~~e.priority,t=o?"已审核":"未审核";return f(N,{color:o?"blue":"red"},(()=>t))}}],_=[{field:"productName",label:"商品名称",component:"Input",componentProps:{placeholder:"请输入商品名称"}},{field:"priority",label:"审核状态",component:"Select",componentProps:{placeholder:"请选择审核状态",options:[{label:"已审核",value:"1",key:"1"},{label:"未审核",value:"2",key:"2"}]}},{field:"enableStatus",label:"上架状态",component:"Select",componentProps:{placeholder:"请选择上架状态",options:[{label:"已上架",value:"1",key:"1"},{label:"已下架",value:"2",key:"2"}]}}],M=[{field:"id",label:"商品Id",component:"Input",show:!1,componentProps:{placeholder:"请输入商品Id"}},{field:"productName",label:"商品名称",component:"Input",componentProps:{placeholder:"请输入商品名称"}},{field:"productDesc",label:"商品描述",component:"Input",componentProps:{placeholder:"请输入商品描述"}},{field:"imgAddr",label:"商品图片",component:"UploadImg",componentProps:({formModel:e})=>({uploadApi:R,value:e.imgAddr,btnText:"选择图片",btnProps:{preIcon:"ant-design:cloud-upload-outlined"},width:"150"})},{field:"productCategoryId",label:"商品类别",component:"ApiRadioGroup",required:!0,ifShow:!1,componentProps:{api:k,params:{dictCode:"fubao_product_category"}},defaultValue:"2"},{field:"normalPrice",label:"商品原价",component:"Input",rules:[{required:!0,validator:(e,o)=>isNaN(o)?Promise.reject("请输入数字"):Promise.resolve()}],renderComponentContent:()=>({prefix:()=>"￥"}),componentProps:{placeholder:"请输入商品原价"}},{field:"promotionPrice",label:"商品折扣价",component:"Input",rules:[{required:!0,validator:(e,o)=>isNaN(o)?Promise.reject("请输入数字"):Promise.resolve()}],renderComponentContent:()=>({prefix:()=>"￥"}),componentProps:{placeholder:"请输入商品折扣价"},defaultValue:0},{field:"stock",label:"商品库存",component:"Input",suffix:"件",rules:[{required:!0,validator:(e,o)=>isNaN(o)?Promise.reject("请输入数字"):Promise.resolve()}],componentProps:{placeholder:"请输入商品库存"}},{field:"expireTime",label:"商品有效期",component:"Input",helpMessage:"不填默认为永久有效",suffix:"天",componentProps:{placeholder:"请输入商品有效期"}},{field:"enableStatus",label:"上架状态",component:"ApiRadioGroup",required:!0,componentProps:{api:k,params:{dictCode:"fubao_product_enableStatus"}},defaultValue:"1"},{field:"isBirth",label:"有效期关联时间",component:"RadioGroup",ifShow:({values:e})=>!!e.expireTime,componentProps:{options:[{label:"与分娩时间关联",value:"1"},{label:"与领取时间关联",value:"2"},{label:"不关联",value:""}]}},{field:"createByAid",label:"创建人",component:"Input",slot:"createByAid",show:!1,componentProps:{}}],T=b({__name:"FormModal",emits:["success","register"],setup(e,{emit:o}){const t=h((()=>v(r)?"编辑商品":"新增商品")),r=P(!1),l=P(),a=P(),{createMessage:i}=O(),[f,{setFieldsValue:b,resetFields:N,validate:R}]=u({labelWidth:100,schemas:M,showActionButtonGroup:!1,actionColOptions:{span:23},baseColProps:{lg:12,md:24}}),[k,{setModalProps:B,closeModal:_}]=p((e=>s(this,null,(function*(){if(yield N(),B({confirmLoading:!1}),r.value=!!(null==e?void 0:e.isUpdate),a.value=null==e?void 0:e.record.deptId,v(r)){l.value=e.record.id;const o=yield A({id:e.record.id});-1===o.expireTime&&(o.expireTime=null,o.isBirth=null),yield b(d(n({},o),{createByAid:y().getUserInfo.userId}))}}))));function T(){return s(this,null,(function*(){try{const e=yield R();B({confirmLoading:!0}),v(r)?yield S(d(n({},e),{id:l.value})):yield C(d(n({},e),{shopId:a.value})),v(r)?i.success("编辑成功！"):i.success("新增成功！"),_(),o("success",{isUpdate:v(r),values:d(n({},e),{id:l.value})})}finally{B({confirmLoading:!1})}}))}return(e,o)=>(I(),x(v(c),j({title:t.value,destroyOnClose:""},e.$attrs,{width:"900px",onOk:T,onRegister:v(k)}),{default:g((()=>[w(v(m),{onRegister:v(f)},null,8,["onRegister"])])),_:1},16,["title","onRegister"]))}});export{T as _,B as c,_ as s};
