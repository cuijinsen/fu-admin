var e=(e,a,s)=>new Promise(((t,n)=>{var o=e=>{try{l(s.next(e))}catch(a){n(a)}},i=e=>{try{l(s.throw(e))}catch(a){n(a)}},l=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,i);l((s=s.apply(e,a)).next())}));import{b as a,B as s}from"./index-b361c612.js";import{a as t,s as n,bs as o,o as i,i as l,y as r,m as u,h as c,aG as d,E as m}from"./index-d32d699d.js";import{_ as f}from"./index-5d4f29a6.js";import{s as v}from"./sysMenuApi-b7b39e4b.js";import{s as y,b as p}from"./sysRoleApi-b6b41faf.js";const h=t({__name:"FormModalAssignMenu",emits:["success","register"],setup(t,{emit:h}){const b=n([]),g=n(),k=n([]),x=n([]),M=n(new Set),j=n(!1);o((()=>{!function(){e(this,null,(function*(){b.value=yield v()}))}()}));const{createMessage:w,createConfirm:I}=m(),[_,{setModalProps:A,closeModal:C}]=a((a=>e(this,null,(function*(){A({confirmLoading:!1}),g.value=a.record.id;const e=yield y({roleId:g.value});M.value=new Set(e.filter((e=>"0"!==e.parentId)).map((e=>e.parentId))),k.value=e.filter((e=>!M.value.has(e.id))).map((e=>e.id))}))));function K(e,a){c(j)||(j.value=!0),k.value=e,x.value=a.halfCheckedKeys}function L(){return e(this,null,(function*(){try{I({iconType:"warning",title:"提示",content:"确认分配菜单？",onOk:()=>e(this,null,(function*(){A({confirmLoading:!0});const e=c(j)?[...k.value,...x.value]:[...k.value,...Array.from(M.value)];yield p({menuIds:e,roleId:g.value}),w.success("分配成功！"),C(),h("success",g.value)}))})}finally{A({confirmLoading:!1})}}))}return(e,a)=>(i(),l(c(s),d(e.$attrs,{destroyOnClose:"",onRegister:c(_),title:"分配菜单",onOk:L}),{default:r((()=>[u(c(f),{checkedKeys:k.value,treeData:b.value,checkable:"",onCheck:K,fieldNames:{key:"id",title:"name"}},null,8,["checkedKeys","treeData"])])),_:1},16,["onRegister"]))}});export{h as _};
