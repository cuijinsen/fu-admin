var e=(e,t,o)=>new Promise(((n,a)=>{var s=e=>{try{i(o.next(e))}catch(t){a(t)}},r=e=>{try{i(o.throw(e))}catch(t){a(t)}},i=e=>e.done?n(e.value):Promise.resolve(e.value).then(s,r);i((o=o.apply(e,t)).next())}));import{u as t,B as o}from"./useTable-ba3fb261.js";import{T as n}from"./useForm-39f6e704.js";import{bV as a,a as s,s as r,bs as i,r as l,K as d,at as c,aF as p,bT as u,o as m,f,m as h,y as g,w as y,i as b,z as v,h as I,t as x,f6 as C,j as w,E as P}from"./index-d32d699d.js";import{T as k}from"./index-280a19eb.js";import{s as j}from"./sysAreaApi-e41d1f2f.js";import{f as _,e as S}from"./userApi-36d22843.js";import{s as T}from"./index-2e5c6a76.js";import{a as N}from"./download-29600a9b.js";import{_ as F}from"./DetailModal.vue_vue_type_script_setup_true_lang-e53fb8be.js";import{a as D}from"./index-35313998.js";const O=[{title:"用户姓名",dataIndex:"patientName",auth:"root",width:80},{title:"领取人姓名",dataIndex:"getName",width:120},{title:"领取人手机号",dataIndex:"getPhone",width:120},{title:"核销时间",dataIndex:"verifyTime",sorter:!0,width:180},{title:"创建时间",dataIndex:"createTime",sorter:!0,width:180},{title:"状态",dataIndex:"userStatus",filters:[{text:"已选择",value:"1"},{text:"已领取",value:"2"},{text:"部分核销",value:"3"},{text:"已核销",value:"4"},{text:"已关注",value:"5"},{text:"已验证",value:"6"},{text:"已授权",value:"7"}],customRender:({record:e})=>{const t=e.userStatus,o=e.openId,n=e.shipping;return"1"===t?a(k,{color:"blue"},(()=>"已选择")):"2"===t?a(k,{color:"green"},(()=>"已领取")):"3"===t?a(k,{color:"orange"},(()=>"部分核销")):"4"===t?a(k,{color:"red"},(()=>"已核销")):"0"===t&&o&&!n?a(k,{color:"yellow"},(()=>"已关注")):"0"!==t||o?"0"===t&&n?a(k,{color:"cyan"},(()=>"已授权")):void 0:a(k,{color:"purple"},(()=>"已验证"))},width:80},{title:"openId",dataIndex:"openId",auth:"root",width:220},{title:"领取时间",dataIndex:"paymentTime",sorter:!0,width:180}],R=[{field:"getName",label:"领取人姓名",component:"Input",componentProps:{placeholder:"请输入领取人姓名"}},{field:"getPhone",label:"领取手机号",component:"Input",rules:[{trigger:"blur",pattern:/^1[3456789]\d{9}$/,message:"请输入正确的手机号"}],componentProps:{placeholder:"请输入领取人手机号"}},{field:"patientName",label:"用户姓名",component:"Input",componentProps:{placeholder:"请输入用户姓名"}},{field:"province",component:"ApiSelect",label:"省份",colProps:{span:8},componentProps:({formModel:t,formActionType:o})=>({params:{parentCode:"0"},labelField:"areaName",valueField:"areaCode",api:j,placeholder:"请选择省份",onChange:n=>e(void 0,null,(function*(){let a;yield j({parentCode:n}).then((e=>{a=e.map((e=>({id:e.areaCode,label:e.areaName,value:e.areaCode,key:e.areaCode})))}));const s=void 0!==n?a:[];t.city=void 0,t.district=void 0;const{updateSchema:r}=o;yield r({field:"city",componentProps:{placeholder:"请先选择省份",options:s,onChange:n=>e(void 0,null,(function*(){let e;yield j({parentCode:n}).then((t=>{e=t.map((e=>({id:e.areaCode,label:e.areaName,value:e.areaCode,key:e.areaCode})))}));const a=void 0!==n?e:[];t.district=void 0;const{updateSchema:s}=o;yield s({field:"district",componentProps:{options:a}})}))}})}))})},{field:"city",component:"Select",label:"城市",colProps:{span:8},componentProps:({formModel:t})=>({placeholder:"请先选择省份",options:[],onChange:()=>e(void 0,null,(function*(){t.district=void 0}))})},{field:"district",component:"Select",label:"区县",colProps:{span:8},componentProps:{options:[],placeholder:"请先选择城市"}},{field:"[startTime, endTime]",label:"领取时间",component:"RangePicker",componentProps:{format:"YYYY-MM-DD HH:mm:ss",placeholder:["开始时间","结束时间"],showTime:{format:"HH:mm:ss"}}}],M={key:1},U={key:2},A=s({__name:"index",props:{nodeId:{type:String}},setup(a,{expose:s}){const j=a,A=r(!1),H=r([]);i((()=>e(this,null,(function*(){H.value=yield T({dictCode:"user_status"})}))));const{createConfirm:Y}=P(),[B,{openDrawer:E}]=D(),[K,{reload:V,getForm:z}]=t({title:"用户列表 ",api:_,rowKey:"userId",columns:O,formConfig:{baseColProps:{sm:24,lg:12},labelWidth:90,schemas:R,autoSubmitOnEnter:!0,resetButtonOptions:{preIcon:"ant-design:delete-outlined"},submitButtonOptions:{preIcon:"ant-design:search-outlined"}},showIndexColumn:!1,useSearchForm:!0,showTableSetting:!0,bordered:!0,actionColumn:{auth:["system:user:selectUserDetail"],width:80,title:"操作",dataIndex:"action"},beforeFetch:function(e){return Object.assign(e,{deptId:j.nodeId,ownDeptId:l().getUserInfo.deptId,userId:l().getUserInfo.userId})}});function W(t){return e(this,null,(function*(){A.value=!0,Object.assign(t,{deptId:j.nodeId}),E(!0,{record:t})}))}function $(){return e(this,null,(function*(){Y({iconType:"warning",title:"提示",content:"确认导出？",onOk:()=>e(this,null,(function*(){const e=z().getFieldsValue();Object.assign(e,{deptId:j.nodeId});const t=yield S(e),o=t.data,n=t.headers["content-disposition"].split(";")[1].split("=")[1],a=decodeURIComponent(escape(n));N(o,a)}))})}))}return d((()=>j.nodeId),(()=>{c((()=>{V()}))})),s({refresh:function(){V()}}),(e,t)=>{const a=p("a-button"),s=u("auth");return m(),f("div",null,[h(I(o),{onRegister:I(K)},{toolbar:g((()=>[y((m(),b(a,{color:"warning",preIcon:"ant-design:download-outlined",onClick:$},{default:g((()=>[v("导出 ")])),_:1})),[[s,["system:user:exportUser"]]])])),bodyCell:g((({column:e,record:t})=>["status"===e.key?(m(),b(I(k),{key:0,color:"1"===t.userStatus?"processing":"success"},{default:g((()=>[v(x(I(C)(H.value,t.userStatus)),1)])),_:2},1032,["color"])):w("",!0),"getName"===e.key?(m(),f("span",M,x(t.shipping.receiverName),1)):w("",!0),"getPhone"===e.key?(m(),f("span",U,x(t.shipping.receiverMobile),1)):w("",!0),"action"===e.key?(m(),b(I(n),{key:3,actions:[{auth:["system:user:selectUserDetail"],icon:"ant-design:eye-outlined",tooltip:"查看",onClick:W.bind(null,t)}]},null,8,["actions"])):w("",!0)])),_:1},8,["onRegister"]),A.value?(m(),b(F,{key:0,onClose:t[0]||(t[0]=e=>A.value=e),onRegister:I(B)},null,8,["onRegister"])):w("",!0)])}}});export{A as _};
