var K=Object.defineProperty,Q=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var _=(e,o,t)=>o in e?K(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,W=(e,o)=>{for(var t in o||(o={}))x.call(o,t)&&_(e,t,o[t]);if(j)for(var t of j(o))ee.call(o,t)&&_(e,t,o[t]);return e},X=(e,o)=>Q(e,Z(o));var E=(e,o,t)=>new Promise((i,l)=>{var d=a=>{try{n(t.next(a))}catch(u){l(u)}},c=a=>{try{n(t.throw(a))}catch(u){l(u)}},n=a=>a.done?i(a.value):Promise.resolve(a.value).then(d,c);n((t=t.apply(e,o)).next())});import{a as F,v as T,b as V,f as k,O as oe,c1 as te,i as D,ay as L,bv as ae,o as z,h as O,x as re,y as ne,m as I,bo as B,q as C,bm as le,c as Y,az as se,aA as $,j as P,z as y,k as U,n as r,aB as q,G,b8 as ie,M as pe,a9 as de,B as ce,t as ue,aH as H}from"./index.437c4479.js";import{C as me}from"./cropper.bcc4a72c.js";import{S as ge}from"./index.db2dd425.js";import{U as fe}from"./index.5072074a.js";import"./index.ddab58b9.js";import{A as ve}from"./index.51f3da4c.js";import{B as ye,a as be,b as he}from"./index.d115f57c.js";import{d as Ce}from"./base64Conver.08b9f4ec.js";const Se={aspectRatio:1,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,autoCrop:!0,background:!0,highlight:!0,center:!0,responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,scalable:!0,modal:!0,guides:!0,movable:!0,rotatable:!0},$e={src:{type:String,required:!0},alt:{type:String},circled:{type:Boolean,default:!1},realTimePreview:{type:Boolean,default:!0},height:{type:[String,Number],default:"360px"},crossorigin:{type:String,default:void 0},imageStyle:{type:Object,default:()=>({})},options:{type:Object,default:()=>({})}},we=F({name:"CropperImage",props:$e,emits:["cropend","ready","cropendError"],setup(e,{attrs:o,emit:t}){const i=T(),l=T(),d=T(!1),{prefixCls:c}=V("cropper-image"),n=ae(w,80),a=k(()=>W({height:e.height,maxWidth:"100%"},e.imageStyle)),u=k(()=>[c,o.class,{[`${c}--circled`]:e.circled}]),M=k(()=>({height:`${e.height}`.replace(/px/,"")+"px"}));oe(v),te(()=>{var p;(p=l.value)==null||p.destroy()});function v(){return E(this,null,function*(){const p=D(i);!p||(l.value=new me(p,W(X(W({},Se),{ready:()=>{d.value=!0,w(),t("ready",l.value)},crop(){n()},zoom(){n()},cropmove(){n()}}),e.options)))})}function w(){e.realTimePreview&&m()}function m(){if(!l.value)return;let p=l.value.getData();(e.circled?R():l.value.getCroppedCanvas()).toBlob(g=>{if(!g)return;let S=new FileReader;S.readAsDataURL(g),S.onloadend=s=>{var h,f;t("cropend",{imgBase64:(f=(h=s.target)==null?void 0:h.result)!=null?f:"",imgInfo:p})},S.onerror=()=>{t("cropendError")}},"image/png")}function R(){const p=l.value.getCroppedCanvas(),b=document.createElement("canvas"),g=b.getContext("2d"),S=p.width,s=p.height;return b.width=S,b.height=s,g.imageSmoothingEnabled=!0,g.drawImage(p,0,0,S,s),g.globalCompositeOperation="destination-in",g.beginPath(),g.arc(S/2,s/2,Math.min(S,s)/2,0,2*Math.PI,!0),g.fill(),b}return{getClass:u,imgElRef:i,getWrapperStyle:M,getImageStyle:a,isReady:d,croppered:m}}}),Ie=["src","alt","crossorigin"];function ke(e,o,t,i,l,d){return z(),O("div",{class:C(e.getClass),style:B(e.getWrapperStyle)},[re(I("img",{ref:"imgElRef",src:e.src,alt:e.alt,crossorigin:e.crossorigin,style:B(e.getImageStyle)},null,12,Ie),[[ne,e.isReady]])],6)}var J=L(we,[["render",ke]]);const ze={circled:{type:Boolean,default:!0},uploadApi:{type:Function}},Me=F({name:"CropperModal",components:{BasicModal:ye,Space:ge,CropperImage:J,Upload:fe,Avatar:ve,Tooltip:le},props:ze,emits:["uploadSuccess","register"],setup(e,{emit:o}){let t="";const i=T(""),l=T(""),d=T();let c=1,n=1;const{createMessage:a}=G(),{prefixCls:u}=V("cropper-am"),[M,{closeModal:v,setModalProps:w}]=be(),{t:m}=Y();function R(s){const h=new FileReader;return h.readAsDataURL(s),i.value="",l.value="",h.onload=function(f){var A,N;i.value=(N=(A=f.target)==null?void 0:A.result)!=null?N:"",t=s.name},!1}function p({imgBase64:s}){l.value=s}function b(s){d.value=s}function g(s,h){var f,A;s==="scaleX"&&(c=h=c===-1?1:-1),s==="scaleY"&&(n=h=n===-1?1:-1),(A=(f=d==null?void 0:d.value)==null?void 0:f[s])==null||A.call(f,h)}function S(){return E(this,null,function*(){const s=e.uploadApi;if(s&&se(s)){const h=Ce(l.value);try{w({confirmLoading:!0});const f=yield s({name:"file",file:h,filename:t,data:{bizPath:"image"}});if(f.data.code!==200){a.error(f.data.msg||"\u4E0A\u4F20\u5931\u8D25");return}o("uploadSuccess",{source:l.value,data:f.data.data}),v()}finally{w({confirmLoading:!1})}}})}return{t:m,prefixCls:u,src:i,register:M,previewSource:l,handleBeforeUpload:R,handleCropend:p,handleReady:b,handlerToolbar:g,handleOk:S}}}),Te=["src","alt"];function Be(e,o,t,i,l,d){const c=$("CropperImage"),n=$("a-button"),a=$("Tooltip"),u=$("Upload"),M=$("Space"),v=$("Avatar"),w=$("BasicModal");return z(),P(w,q(e.$attrs,{onRegister:e.register,title:e.t("component.cropper.modalTitle"),width:"800px",canFullscreen:!1,onOk:e.handleOk,okText:e.t("component.cropper.okText")}),{default:y(()=>[I("div",{class:C(e.prefixCls)},[I("div",{class:C(`${e.prefixCls}-left`)},[I("div",{class:C(`${e.prefixCls}-cropper`)},[e.src?(z(),P(c,{key:0,src:e.src,height:"300px",circled:e.circled,onCropend:e.handleCropend,onReady:e.handleReady},null,8,["src","circled","onCropend","onReady"])):U("",!0)],2),I("div",{class:C(`${e.prefixCls}-toolbar`)},[r(u,{fileList:[],accept:"image/*",beforeUpload:e.handleBeforeUpload},{default:y(()=>[r(a,{title:e.t("component.cropper.selectImage"),placement:"bottom"},{default:y(()=>[r(n,{size:"small",preIcon:"ant-design:upload-outlined",type:"primary"})]),_:1},8,["title"])]),_:1},8,["beforeUpload"]),r(M,null,{default:y(()=>[r(a,{title:e.t("component.cropper.btn_reset"),placement:"bottom"},{default:y(()=>[r(n,{type:"primary",preIcon:"ant-design:reload-outlined",size:"small",disabled:!e.src,onClick:o[0]||(o[0]=m=>e.handlerToolbar("reset"))},null,8,["disabled"])]),_:1},8,["title"]),r(a,{title:e.t("component.cropper.btn_rotate_left"),placement:"bottom"},{default:y(()=>[r(n,{type:"primary",preIcon:"ant-design:rotate-left-outlined",size:"small",disabled:!e.src,onClick:o[1]||(o[1]=m=>e.handlerToolbar("rotate",-45))},null,8,["disabled"])]),_:1},8,["title"]),r(a,{title:e.t("component.cropper.btn_rotate_right"),placement:"bottom"},{default:y(()=>[r(n,{type:"primary",preIcon:"ant-design:rotate-right-outlined",size:"small",disabled:!e.src,onClick:o[2]||(o[2]=m=>e.handlerToolbar("rotate",45))},null,8,["disabled"])]),_:1},8,["title"]),r(a,{title:e.t("component.cropper.btn_scale_x"),placement:"bottom"},{default:y(()=>[r(n,{type:"primary",preIcon:"vaadin:arrows-long-h",size:"small",disabled:!e.src,onClick:o[3]||(o[3]=m=>e.handlerToolbar("scaleX"))},null,8,["disabled"])]),_:1},8,["title"]),r(a,{title:e.t("component.cropper.btn_scale_y"),placement:"bottom"},{default:y(()=>[r(n,{type:"primary",preIcon:"vaadin:arrows-long-v",size:"small",disabled:!e.src,onClick:o[4]||(o[4]=m=>e.handlerToolbar("scaleY"))},null,8,["disabled"])]),_:1},8,["title"]),r(a,{title:e.t("component.cropper.btn_zoom_in"),placement:"bottom"},{default:y(()=>[r(n,{type:"primary",preIcon:"ant-design:zoom-in-outlined",size:"small",disabled:!e.src,onClick:o[5]||(o[5]=m=>e.handlerToolbar("zoom",.1))},null,8,["disabled"])]),_:1},8,["title"]),r(a,{title:e.t("component.cropper.btn_zoom_out"),placement:"bottom"},{default:y(()=>[r(n,{type:"primary",preIcon:"ant-design:zoom-out-outlined",size:"small",disabled:!e.src,onClick:o[6]||(o[6]=m=>e.handlerToolbar("zoom",-.1))},null,8,["disabled"])]),_:1},8,["title"])]),_:1})],2)],2),I("div",{class:C(`${e.prefixCls}-right`)},[I("div",{class:C(`${e.prefixCls}-preview`)},[e.previewSource?(z(),O("img",{key:0,src:e.previewSource,alt:e.t("component.cropper.preview")},null,8,Te)):U("",!0)],2),e.previewSource?(z(),O("div",{key:0,class:C(`${e.prefixCls}-group`)},[r(v,{src:e.previewSource,size:"large"},null,8,["src"]),r(v,{src:e.previewSource,size:48},null,8,["src"]),r(v,{src:e.previewSource,size:64},null,8,["src"]),r(v,{src:e.previewSource,size:80},null,8,["src"])],2)):U("",!0)],2)],2)]),_:1},16,["onRegister","title","onOk","okText"])}var Re=L(Me,[["render",Be]]);const Ae={width:{type:[String,Number],default:"200px"},value:{type:String},showBtn:{type:Boolean,default:!0},btnProps:{type:Object},btnText:{type:String,default:""},uploadApi:{type:Function}},Ue=F({name:"CropperAvatar",components:{CopperModal:Re,Icon:ie},props:Ae,emits:["update:value","change"],setup(e,{emit:o,expose:t}){const i=T(e.value||""),{prefixCls:l}=V("cropper-avatar"),[d,{openModal:c,closeModal:n}]=he(),{createMessage:a}=G(),{t:u}=Y(),M=k(()=>[l]),v=k(()=>`${e.width}`.replace(/px/,"")+"px"),w=k(()=>parseInt(`${e.width}`.replace(/px/,""))/2+"px"),m=k(()=>({width:D(v)})),R=k(()=>({width:D(v),height:D(v)}));pe(()=>{i.value=e.value||""}),de(()=>i.value,b=>{o("update:value",b)});function p({source:b,data:g}){i.value=b,o("change",g),a.success(u("component.cropper.uploadSuccess"))}return t({openModal:c.bind(null,!0),closeModal:n}),{t:u,prefixCls:l,register:d,openModal:c,getIconWidth:w,sourceValue:i,getClass:M,getImageWrapperStyle:R,getStyle:m,handleUploadSuccess:p}}}),Oe=["src"];function We(e,o,t,i,l,d){const c=$("Icon"),n=$("a-button"),a=$("CopperModal");return z(),O("div",{class:C(e.getClass),style:B(e.getStyle)},[I("div",{class:C(`${e.prefixCls}-image-wrapper`),style:B(e.getImageWrapperStyle),onClick:o[0]||(o[0]=(...u)=>e.openModal&&e.openModal(...u))},[I("div",{class:C(`${e.prefixCls}-image-mask`),style:B(e.getImageWrapperStyle)},[r(c,{icon:"ant-design:cloud-upload-outlined",size:e.getIconWidth,style:B(e.getImageWrapperStyle),color:"#d6d6d6"},null,8,["size","style"])],6),e.sourceValue?(z(),O("img",{key:0,src:e.sourceValue,alt:"avatar"},null,8,Oe)):U("",!0)],6),e.showBtn?(z(),P(n,q({key:0,class:`${e.prefixCls}-upload-btn`,onClick:e.openModal},e.btnProps),{default:y(()=>[ce(ue(e.btnText?e.btnText:e.t("component.cropper.selectImage")),1)]),_:1},16,["class","onClick"])):U("",!0),r(a,{onRegister:e.register,onUploadSuccess:e.handleUploadSuccess,uploadApi:e.uploadApi,src:e.sourceValue},null,8,["onRegister","onUploadSuccess","uploadApi","src"])],6)}var De=L(Ue,[["render",We],["__scopeId","data-v-6331b29e"]]);const Ye=H(J),qe=H(De);export{Ye as C,qe as a};
