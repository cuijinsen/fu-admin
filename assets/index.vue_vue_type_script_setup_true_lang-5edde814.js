var e=(e,t,o)=>new Promise(((s,n)=>{var i=e=>{try{d(o.next(e))}catch(t){n(t)}},r=e=>{try{d(o.throw(e))}catch(t){n(t)}},d=e=>e.done?s(e.value):Promise.resolve(e.value).then(i,r);d((o=o.apply(e,t)).next())}));import{u as t,B as o}from"./useTable-ba3fb261.js";import{T as s}from"./useForm-39f6e704.js";import{a as n,s as i,bs as r,K as d,at as a,aF as c,bT as u,o as l,f as p,m,y as f,w as y,i as h,z as g,h as b,j as I,E as P}from"./index-d32d699d.js";import{I as _}from"./index-a72363e5.js";import{u as v}from"./index-b361c612.js";import{c as C,s as k,_ as w}from"./FormModal.vue_vue_type_script_setup_true_lang-ad14182b.js";import{f as x,r as j,b as F,c as R}from"./productApi-29a579d7.js";import{s as S}from"./index-2e5c6a76.js";import{a as O}from"./download-29600a9b.js";const T=n({__name:"index",props:{nodeId:{type:String}},emits:["refresh-tree"],setup(n,{expose:T,emit:U}){const A=n,B=i([]),K=i([]),M=i([]);r((()=>e(this,null,(function*(){B.value=yield S({dictCode:"sys_status"}),K.value=yield S({dictCode:"sys_lock_flag"}),M.value=yield S({dictCode:"sys_sex"})}))));const{createMessage:z,createConfirm:E}=P(),[D,{openModal:V}]=v(),[W,{reload:q,getForm:G,getSelectRowKeys:H}]=t({title:"审批列表 ",api:x,rowKey:"id",columns:C,formConfig:{baseColProps:{sm:24,lg:6},labelWidth:90,schemas:k,autoSubmitOnEnter:!0,resetButtonOptions:{preIcon:"ant-design:delete-outlined"},submitButtonOptions:{preIcon:"ant-design:search-outlined"}},showIndexColumn:!1,useSearchForm:!0,showTableSetting:!0,bordered:!0,actionColumn:{auth:["system:Product:updateProduct","system:Product:removeProduct","system:Product:approveProduct"],width:120,title:"操作",dataIndex:"action"},beforeFetch:function(e){return Object.assign(e,{deptId:A.nodeId})}});function J(){const e={deptId:A.nodeId};V(!0,{record:e,isUpdate:!1})}function L(e){e.deptId=""===e.deptId?null:e.deptId,V(!0,{record:e,isUpdate:!0})}function N(t){return e(this,null,(function*(){yield j({ids:t.id}),z.success("删除成功！"),yield q()}))}function Q(t){return e(this,null,(function*(){yield F({ids:t.id}),z.success("审批成功！"),yield q()}))}function X(){return e(this,null,(function*(){const e=H();yield F({ids:e}),z.success("审批成功！"),yield q()}))}function Y(){return e(this,null,(function*(){E({iconType:"warning",title:"提示",content:"确认导出？",onOk:()=>e(this,null,(function*(){const e=G().getFieldsValue(),t=yield R(e),o=t.data;if(!t.headers["content-disposition"])return void z.error("导出失败！");const s=t.headers["content-disposition"].split(";")[1].split("=")[1],n=decodeURIComponent(escape(s));O(o,n)}))})}))}function Z(t){return e(this,arguments,(function*({isUpdate:e,values:t}){U("refresh-tree",t.deptId),yield q()}))}return d((()=>A.nodeId),(()=>{a((()=>{q()}))})),T({refresh:function(){q()}}),(e,t)=>{const n=c("a-button"),i=u("auth");return l(),p("div",null,[m(b(o),{onRegister:b(W)},{toolbar:f((()=>[y((l(),h(n,{color:"success",preIcon:"ant-design:check-outlined",onClick:X},{default:f((()=>[g("批量审批 ")])),_:1})),[[i,["system:sysDept:removeProduct"]]]),y((l(),h(n,{preIcon:"ant-design:plus-outlined",type:"primary",onClick:J},{default:f((()=>[g("新增 ")])),_:1})),[[i,["system:Product:addProduct"]]]),y((l(),h(n,{color:"warning",preIcon:"ant-design:download-outlined",onClick:Y},{default:f((()=>[g("导出 ")])),_:1})),[[i,["system:Product:exportProduct"]]])])),bodyCell:f((({column:e,record:t})=>["imgAddr"===e.key?(l(),h(b(_),{key:0,size:60,src:t.imgAddr},null,8,["src"])):I("",!0),"action"===e.key?(l(),h(b(s),{key:1,actions:[{auth:["system:sysUser:resetPwd"],icon:"ant-design:check-outlined",tooltip:"审批通过",onClick:Q.bind(null,t)},{auth:["system:Product:updateProduct"],icon:"clarity:note-edit-line",tooltip:"编辑",onClick:L.bind(null,t)},{auth:["system:Product:removeProduct"],icon:"ant-design:delete-outlined",tooltip:"删除",color:"error",popConfirm:{title:"是否确认删除",confirm:N.bind(null,t)}}]},null,8,["actions"])):I("",!0)])),_:1},8,["onRegister"]),m(w,{onRegister:b(D),onSuccess:Z},null,8,["onRegister"])])}}});export{T as _};
