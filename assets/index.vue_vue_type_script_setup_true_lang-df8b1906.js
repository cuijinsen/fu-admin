var e=(e,t,o)=>new Promise(((n,s)=>{var r=e=>{try{d(o.next(e))}catch(t){s(t)}},i=e=>{try{d(o.throw(e))}catch(t){s(t)}},d=e=>e.done?n(e.value):Promise.resolve(e.value).then(r,i);d((o=o.apply(e,t)).next())}));import{u as t,B as o}from"./useTable-ba3fb261.js";import{T as n}from"./useForm-39f6e704.js";import{a as s,s as r,K as i,at as d,aF as u,bT as a,o as c,f as l,m as p,y as m,w as f,i as y,z as g,h,j as _,r as I,E as v}from"./index-d32d699d.js";import{I as b}from"./index-a72363e5.js";import{u as P}from"./index-b361c612.js";import{c as C,s as x,_ as S}from"./FormModal.vue_vue_type_script_setup_true_lang-b9498216.js";import{g as j,h as k,r as w,j as R,c as F}from"./productApi-29a579d7.js";import{a as T}from"./download-29600a9b.js";import{_ as U}from"./AddStock.vue_vue_type_script_setup_true_lang-6adc8545.js";import{_ as A}from"./AddShowProduct.vue_vue_type_script_setup_true_lang-b0734e8c.js";import D from"./excelTest-083acd0a.js";const M=s({__name:"index",props:{nodeId:{type:String}},setup(s,{expose:M}){const O=s,E=r({title:"",dataSource:[],columns:[]}),{createMessage:B,createConfirm:K}=v(),[z,{openModal:V}]=P(),[W,{openModal:q}]=P(),[G,{openModal:H}]=P(),[J,{reload:L,getForm:N,getSelectRowKeys:Q}]=t({title:"商品列表 ",api:j,rowKey:"id",columns:C,formConfig:{baseColProps:{sm:24,lg:6},labelWidth:90,schemas:x,autoSubmitOnEnter:!0,resetButtonOptions:{preIcon:"ant-design:delete-outlined"},submitButtonOptions:{preIcon:"ant-design:search-outlined"}},showIndexColumn:!1,useSearchForm:!0,showTableSetting:!0,bordered:!0,actionColumn:{auth:["system:Product:updateProduct","system:Product:removeProduct"],width:120,title:"操作",dataIndex:"action"},beforeFetch:function(e){return Object.assign(e,{deptId:O.nodeId})}});function X(){let e=O.nodeId;null==e&&(e=I().getUserInfo.deptId);V(!0,{record:{deptId:e},isUpdate:!1})}function Y(e){e.deptId=""===e.deptId?null:e.deptId,V(!0,{record:e,isUpdate:!0})}function Z(t){return e(this,null,(function*(){E.value=t;let e=O.nodeId;if(null==e)return void B.error("请先选择部门！");const o=yield k({deptId:e,dataSource:E.value.dataSource});"导入成功"==o?B.success("导入成功！"):B.error(o),yield L()}))}function $(t){return e(this,null,(function*(){yield w({ids:t.id}),B.success("删除成功！"),yield L()}))}function ee(t){return e(this,null,(function*(){q(!0,{record:t})}))}function te(){return e(this,null,(function*(){let e=O.nodeId;if(null==e)return void B.error("请先选择部门！");H(!0,{record:{deptId:e}})}))}function oe(){return e(this,null,(function*(){const e=Q();yield w({ids:e}),B.success("删除成功！"),yield L()}))}function ne(){return e(this,null,(function*(){const e=N().getFieldsValue(),t=yield R(e),o=t.data;if(!t.headers["content-disposition"])return void B.error("导出失败！");const n=t.headers["content-disposition"].split(";")[1].split("=")[1],s=decodeURIComponent(escape(n));T(o,s)}))}function se(){return e(this,null,(function*(){K({iconType:"warning",title:"提示",content:"确认导出？",onOk:()=>e(this,null,(function*(){const e=N().getFieldsValue(),t=yield F(e),o=t.data;if(!t.headers["content-disposition"])return void B.error("导出失败！");const n=t.headers["content-disposition"].split(";")[1].split("=")[1],s=decodeURIComponent(escape(n));T(o,s)}))})}))}function re(t){return e(this,arguments,(function*({isUpdate:e,values:t}){yield L()}))}return i((()=>O.nodeId),(()=>{d((()=>{L()}))})),M({refresh:function(){L()}}),(e,t)=>{const s=u("a-button"),r=a("auth");return c(),l("div",null,[p(h(o),{onRegister:h(J)},{toolbar:m((()=>[f((c(),y(s,{color:"error",preIcon:"ant-design:delete-outlined",onClick:oe},{default:m((()=>[g("批量删除 ")])),_:1})),[[r,["system:sysDept:removeProduct"]]]),p(D,{tableData:E.value,onSuccess:Z},{default:m((()=>[f((c(),y(s,{color:"success",preIcon:"ant-design:file-excel-twotone"},{default:m((()=>[g("Excel导入 ")])),_:1})),[[r,["system:sysDept:removeProduct"]]])])),_:1},8,["tableData"]),f((c(),y(s,{onClick:ne},{default:m((()=>[g("Excel模板下载 ")])),_:1})),[[r,["system:sysDept:removeProduct"]]]),f((c(),y(s,{preIcon:"ant-design:plus-outlined",type:"primary",onClick:te},{default:m((()=>[g("批量导入展示商品 ")])),_:1})),[[r,["system:Product:removeProduct"]]]),f((c(),y(s,{preIcon:"ant-design:plus-outlined",type:"primary",onClick:X},{default:m((()=>[g("新增 ")])),_:1})),[[r,["system:Product:addProduct"]]]),f((c(),y(s,{color:"warning",preIcon:"ant-design:download-outlined",onClick:se},{default:m((()=>[g("导出 ")])),_:1})),[[r,["system:Product:exportProduct"]]])])),bodyCell:m((({column:e,record:t})=>["imgAddr"===e.key?(c(),y(h(b),{key:0,size:60,src:t.imgAddr},null,8,["src"])):_("",!0),"action"===e.key?(c(),y(h(n),{key:1,actions:[{auth:["system:Product:updateProduct"],icon:"clarity:note-edit-line",tooltip:"编辑",onClick:Y.bind(null,t)},{auth:["system:Product:removeProduct"],icon:"ant-design:delete-outlined",tooltip:"删除",color:"error",popConfirm:{title:"是否确认删除",confirm:$.bind(null,t)}},{auth:["system:Product:addProductStock"],icon:"ant-design:plus-outlined",tooltip:"添加库存",onClick:ee.bind(null,t)}]},null,8,["actions"])):_("",!0)])),_:1},8,["onRegister"]),p(S,{onRegister:h(z),onSuccess:re},null,8,["onRegister"]),p(U,{onRegister:h(W),onSuccess:re},null,8,["onRegister"]),p(A,{onRegister:h(G),onSuccess:re},null,8,["onRegister"])])}}});export{M as _};
