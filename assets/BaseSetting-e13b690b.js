var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,n=(t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,s=(e,t)=>{for(var a in t||(t={}))r.call(t,a)&&n(e,a,t[a]);if(o)for(var a of o(t))l.call(t,a)&&n(e,a,t[a]);return e},i=(e,o)=>t(e,a(o)),p=(e,t,a)=>new Promise(((o,r)=>{var l=e=>{try{s(a.next(e))}catch(t){r(t)}},n=e=>{try{s(a.throw(e))}catch(t){r(t)}},s=e=>e.done?o(e.value):Promise.resolve(e.value).then(l,n);s((a=a.apply(e,t)).next())}));import{a as c,s as d,b as u,bw as m,e as g,J as f,c2 as b,h as v,L as y,o as h,f as x,w as C,x as j,l as S,bp as w,p as I,bn as _,q as k,aE as z,E as B,aF as O,i as A,y as R,j as M,m as T,aG as U,b9 as P,X as $,K as F,z as W,t as E,N as D,ek as L,B as V,r as N,eI as q,eJ as G,eG as X,eH as H}from"./index-d32d699d.js";import"./index-cd646f4b.js";import{C as J,S as Y,U as K,m as Q,B as Z,k as ee}from"./useForm-39f6e704.js";import{A as te}from"./index-2887dac0.js";import{B as ae,b as oe,u as re}from"./index-b361c612.js";import{h as le}from"./header-e7a2da68.js";import{b as ne}from"./data-6b48484a.js";import{s as se,u as ie}from"./index-2e5c6a76.js";import{R as pe,C as ce}from"./index-8e2feec8.js";import"./index-06c8a48f.js";import"./_baseIteratee-b178d67d.js";import"./get-8e454bdf.js";import"./useSize-e28be3fa.js";import"./index-b4d18824.js";import"./index-da1a1de3.js";import"./index-e84e313c.js";import"./index-ee500efb.js";import"./createForOfIteratorHelper-19a6e609.js";import"./index-280a19eb.js";import"./index-706c8391.js";import"./index-bf8f159c.js";import"./index-fe305bf5.js";import"./iconUtil-b885d1ac.js";import"./eagerComputed-b16e681c.js";import"./index-476a8598.js";import"./index-64da741e.js";import"./index-a72363e5.js";import"./css-49036a2d.js";import"./useRefs-b0536d84.js";import"./download-29600a9b.js";import"./index-406c2228.js";import"./index-22735145.js";import"./uniqBy-19fec0f2.js";import"./useWindowSizeFn-6acabc85.js";import"./FullscreenOutlined-091fbcf5.js";const de={aspectRatio:1,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,autoCrop:!0,background:!0,highlight:!0,center:!0,responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,scalable:!0,modal:!0,guides:!0,movable:!0,rotatable:!0},ue=c({name:"CropperImage",props:{src:{type:String,required:!0},alt:{type:String},circled:{type:Boolean,default:!1},realTimePreview:{type:Boolean,default:!0},height:{type:[String,Number],default:"360px"},crossorigin:{type:String,default:void 0},imageStyle:{type:Object,default:()=>({})},options:{type:Object,default:()=>({})}},emits:["cropend","ready","cropendError"],setup(e,{attrs:t,emit:a}){const o=d(),r=d(),l=d(!1),{prefixCls:n}=u("cropper-image"),c=m(C,80),y=g((()=>s({height:e.height,maxWidth:"100%"},e.imageStyle))),h=g((()=>[n,t.class,{[`${n}--circled`]:e.circled}])),x=g((()=>({height:`${e.height}`.replace(/px/,"")+"px"})));function C(){e.realTimePreview&&j()}function j(){if(!r.value)return;let t=r.value.getData();(e.circled?function(){const e=r.value.getCroppedCanvas(),t=document.createElement("canvas"),a=t.getContext("2d"),o=e.width,l=e.height;return t.width=o,t.height=l,a.imageSmoothingEnabled=!0,a.drawImage(e,0,0,o,l),a.globalCompositeOperation="destination-in",a.beginPath(),a.arc(o/2,l/2,Math.min(o,l)/2,0,2*Math.PI,!0),a.fill(),t}():r.value.getCroppedCanvas()).toBlob((e=>{if(!e)return;let o=new FileReader;o.readAsDataURL(e),o.onloadend=e=>{var o,r;a("cropend",{imgBase64:null!=(r=null==(o=e.target)?void 0:o.result)?r:"",imgInfo:t})},o.onerror=()=>{a("cropendError")}}),"image/png")}return f((function(){return p(this,null,(function*(){const t=v(o);t&&(r.value=new J(t,s(i(s({},de),{ready:()=>{l.value=!0,C(),a("ready",r.value)},crop(){c()},zoom(){c()},cropmove(){c()}}),e.options)))}))})),b((()=>{var e;null==(e=r.value)||e.destroy()})),{getClass:h,imgElRef:o,getWrapperStyle:x,getImageStyle:y,isReady:l,croppered:j}}}),me=["src","alt","crossorigin"];const ge=y(ue,[["render",function(e,t,a,o,r,l){return h(),x("div",{class:I(e.getClass),style:w(e.getWrapperStyle)},[C(S("img",{ref:"imgElRef",src:e.src,alt:e.alt,crossorigin:e.crossorigin,style:w(e.getImageStyle)},null,12,me),[[j,e.isReady]])],6)}]]),fe=c({name:"CropperModal",components:{BasicModal:ae,Space:Y,CropperImage:ge,Upload:K,Avatar:te,Tooltip:_},props:{circled:{type:Boolean,default:!0},uploadApi:{type:Function}},emits:["uploadSuccess","register"],setup(e,{emit:t}){let a="";const o=d(""),r=d(""),l=d();let n=1,s=1;const{createMessage:i}=B(),{prefixCls:c}=u("cropper-am"),[m,{closeModal:g,setModalProps:f}]=oe(),{t:b}=k();return{t:b,prefixCls:c,src:o,register:m,previewSource:r,handleBeforeUpload:function(e){const t=new FileReader;return t.readAsDataURL(e),o.value="",r.value="",t.onload=function(t){var r,l;o.value=null!=(l=null==(r=t.target)?void 0:r.result)?l:"",a=e.name},!1},handleCropend:function({imgBase64:e}){r.value=e},handleReady:function(e){l.value=e},handlerToolbar:function(e,t){var a,o;"scaleX"===e&&(n=t=-1===n?1:-1),"scaleY"===e&&(s=t=-1===s?1:-1),null==(o=null==(a=null==l?void 0:l.value)?void 0:a[e])||o.call(a,t)},handleOk:function(){return p(this,null,(function*(){const o=e.uploadApi;if(o&&z(o)){const e=Q(r.value);try{f({confirmLoading:!0});const l=yield o({name:"file",file:e,filename:a,data:{bizPath:"image"}});if(200!==l.data.code)return void i.error(l.data.msg||"上传失败");t("uploadSuccess",{source:r.value,data:l.data.data}),g()}finally{f({confirmLoading:!1})}}}))}}}}),be=["src","alt"];const ve=c({name:"CropperAvatar",components:{CopperModal:y(fe,[["render",function(e,t,a,o,r,l){const n=O("CropperImage"),s=O("a-button"),i=O("Tooltip"),p=O("Upload"),c=O("Space"),d=O("Avatar"),u=O("BasicModal");return h(),A(u,U(e.$attrs,{onRegister:e.register,title:e.t("component.cropper.modalTitle"),width:"800px",canFullscreen:!1,onOk:e.handleOk,okText:e.t("component.cropper.okText")}),{default:R((()=>[S("div",{class:I(e.prefixCls)},[S("div",{class:I(`${e.prefixCls}-left`)},[S("div",{class:I(`${e.prefixCls}-cropper`)},[e.src?(h(),A(n,{key:0,src:e.src,height:"300px",circled:e.circled,onCropend:e.handleCropend,onReady:e.handleReady},null,8,["src","circled","onCropend","onReady"])):M("",!0)],2),S("div",{class:I(`${e.prefixCls}-toolbar`)},[T(p,{fileList:[],accept:"image/*",beforeUpload:e.handleBeforeUpload},{default:R((()=>[T(i,{title:e.t("component.cropper.selectImage"),placement:"bottom"},{default:R((()=>[T(s,{size:"small",preIcon:"ant-design:upload-outlined",type:"primary"})])),_:1},8,["title"])])),_:1},8,["beforeUpload"]),T(c,null,{default:R((()=>[T(i,{title:e.t("component.cropper.btn_reset"),placement:"bottom"},{default:R((()=>[T(s,{type:"primary",preIcon:"ant-design:reload-outlined",size:"small",disabled:!e.src,onClick:t[0]||(t[0]=t=>e.handlerToolbar("reset"))},null,8,["disabled"])])),_:1},8,["title"]),T(i,{title:e.t("component.cropper.btn_rotate_left"),placement:"bottom"},{default:R((()=>[T(s,{type:"primary",preIcon:"ant-design:rotate-left-outlined",size:"small",disabled:!e.src,onClick:t[1]||(t[1]=t=>e.handlerToolbar("rotate",-45))},null,8,["disabled"])])),_:1},8,["title"]),T(i,{title:e.t("component.cropper.btn_rotate_right"),placement:"bottom"},{default:R((()=>[T(s,{type:"primary",preIcon:"ant-design:rotate-right-outlined",size:"small",disabled:!e.src,onClick:t[2]||(t[2]=t=>e.handlerToolbar("rotate",45))},null,8,["disabled"])])),_:1},8,["title"]),T(i,{title:e.t("component.cropper.btn_scale_x"),placement:"bottom"},{default:R((()=>[T(s,{type:"primary",preIcon:"vaadin:arrows-long-h",size:"small",disabled:!e.src,onClick:t[3]||(t[3]=t=>e.handlerToolbar("scaleX"))},null,8,["disabled"])])),_:1},8,["title"]),T(i,{title:e.t("component.cropper.btn_scale_y"),placement:"bottom"},{default:R((()=>[T(s,{type:"primary",preIcon:"vaadin:arrows-long-v",size:"small",disabled:!e.src,onClick:t[4]||(t[4]=t=>e.handlerToolbar("scaleY"))},null,8,["disabled"])])),_:1},8,["title"]),T(i,{title:e.t("component.cropper.btn_zoom_in"),placement:"bottom"},{default:R((()=>[T(s,{type:"primary",preIcon:"ant-design:zoom-in-outlined",size:"small",disabled:!e.src,onClick:t[5]||(t[5]=t=>e.handlerToolbar("zoom",.1))},null,8,["disabled"])])),_:1},8,["title"]),T(i,{title:e.t("component.cropper.btn_zoom_out"),placement:"bottom"},{default:R((()=>[T(s,{type:"primary",preIcon:"ant-design:zoom-out-outlined",size:"small",disabled:!e.src,onClick:t[6]||(t[6]=t=>e.handlerToolbar("zoom",-.1))},null,8,["disabled"])])),_:1},8,["title"])])),_:1})],2)],2),S("div",{class:I(`${e.prefixCls}-right`)},[S("div",{class:I(`${e.prefixCls}-preview`)},[e.previewSource?(h(),x("img",{key:0,src:e.previewSource,alt:e.t("component.cropper.preview")},null,8,be)):M("",!0)],2),e.previewSource?(h(),x("div",{key:0,class:I(`${e.prefixCls}-group`)},[T(d,{src:e.previewSource,size:"large"},null,8,["src"]),T(d,{src:e.previewSource,size:48},null,8,["src"]),T(d,{src:e.previewSource,size:64},null,8,["src"]),T(d,{src:e.previewSource,size:80},null,8,["src"])],2)):M("",!0)],2)],2)])),_:1},16,["onRegister","title","onOk","okText"])}]]),Icon:P},props:{width:{type:[String,Number],default:"200px"},value:{type:String},showBtn:{type:Boolean,default:!0},btnProps:{type:Object},btnText:{type:String,default:""},uploadApi:{type:Function}},emits:["update:value","change"],setup(e,{emit:t,expose:a}){const o=d(e.value||""),{prefixCls:r}=u("cropper-avatar"),[l,{openModal:n,closeModal:s}]=re(),{createMessage:i}=B(),{t:p}=k(),c=g((()=>[r])),m=g((()=>`${e.width}`.replace(/px/,"")+"px")),f=g((()=>parseInt(`${e.width}`.replace(/px/,""))/2+"px")),b=g((()=>({width:v(m)}))),y=g((()=>({width:v(m),height:v(m)})));return $((()=>{o.value=e.value||""})),F((()=>o.value),(e=>{t("update:value",e)})),a({openModal:n.bind(null,!0),closeModal:s}),{t:p,prefixCls:r,register:l,openModal:n,getIconWidth:f,sourceValue:o,getClass:c,getImageWrapperStyle:y,getStyle:b,handleUploadSuccess:function({source:e,data:a}){o.value=e,t("change",a),i.success(p("component.cropper.uploadSuccess"))}}}}),ye=["src"];const he=y(ve,[["render",function(e,t,a,o,r,l){const n=O("Icon"),s=O("a-button"),i=O("CopperModal");return h(),x("div",{class:I(e.getClass),style:w(e.getStyle)},[S("div",{class:I(`${e.prefixCls}-image-wrapper`),style:w(e.getImageWrapperStyle),onClick:t[0]||(t[0]=(...t)=>e.openModal&&e.openModal(...t))},[S("div",{class:I(`${e.prefixCls}-image-mask`),style:w(e.getImageWrapperStyle)},[T(n,{icon:"ant-design:cloud-upload-outlined",size:e.getIconWidth,style:w(e.getImageWrapperStyle),color:"#d6d6d6"},null,8,["size","style"])],6),e.sourceValue?(h(),x("img",{key:0,src:e.sourceValue,alt:"avatar"},null,8,ye)):M("",!0)],6),e.showBtn?(h(),A(s,U({key:0,class:`${e.prefixCls}-upload-btn`,onClick:e.openModal},e.btnProps),{default:R((()=>[W(E(e.btnText?e.btnText:e.t("component.cropper.selectImage")),1)])),_:1},16,["class","onClick"])):M("",!0),T(i,{onRegister:e.register,onUploadSuccess:e.handleUploadSuccess,uploadApi:e.uploadApi,src:e.sourceValue},null,8,["onRegister","onUploadSuccess","uploadApi","src"])],6)}],["__scopeId","data-v-9ad57506"]]);D(ge);const xe=c({components:{BasicForm:Z,CollapseContainer:L,Button:V,ARow:pe,ACol:ce,CropperAvatar:D(he)},setup(){const{createMessage:e}=B(),t=N(),[a,{setFieldsValue:o,updateSchema:r,validate:l}]=ee({labelWidth:120,schemas:ne,showActionButtonGroup:!1});f((()=>p(this,null,(function*(){const e=yield se({dictCode:"sys_sex"}),t=yield q();o(t),r([{field:"sex",componentProps:{options:e}}])}))));return{avatar:g((()=>{const{avatar:e}=t.getUserInfo;return e||le})),register:a,uploadApi:ie,updateAvatar:function(e){const a=t.getUserInfo;a.avatar=e,t.setUserInfo(a)},handleSubmit:()=>p(this,null,(function*(){const a=yield l(),o=t.getUserInfo;yield G(i(s({},a),{avatar:(null==o?void 0:o.avatar)||null})),o.realName=a.nickname,t.setUserInfo(o),e.success("更新成功！")}))}}}),Ce={class:"change-avatar"},je=(e=>(X("data-v-522d4654"),e=e(),H(),e))((()=>S("div",{class:"mb-2"}," 头像 ",-1)));const Se=y(xe,[["render",function(e,t,a,o,r,l){const n=O("BasicForm"),s=O("a-col"),i=O("CropperAvatar"),p=O("a-row"),c=O("Button"),d=O("CollapseContainer");return h(),A(d,{title:"基本设置",canExpan:!1},{default:R((()=>[T(p,{gutter:24},{default:R((()=>[T(s,{span:14},{default:R((()=>[T(n,{onRegister:e.register},null,8,["onRegister"])])),_:1}),T(s,{span:10},{default:R((()=>[S("div",Ce,[je,T(i,{uploadApi:e.uploadApi,value:e.avatar,btnText:"更换头像",btnProps:{preIcon:"ant-design:cloud-upload-outlined"},onChange:e.updateAvatar,width:"150"},null,8,["uploadApi","value","onChange"])])])),_:1})])),_:1}),T(p,{gutter:24},{default:R((()=>[T(s,{span:10,style:{"text-align":"center"}},{default:R((()=>[T(c,{type:"primary",onClick:e.handleSubmit},{default:R((()=>[W("保存")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-522d4654"]]);export{Se as default};
